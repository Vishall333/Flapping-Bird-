<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flapping Bird - India's Most Trusted Crowdfunding Platform</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #00b386;
            --primary-dark: #009970;
            --secondary: #ff4757;
            --accent: #3742fa;
            --success: #2ed573;
            --warning: #ffa502;
            --danger: #ff3838;
            --dark: #2f3542;
            --light: #f1f2f6;
            --gray: #57606f;
            --white: #ffffff;
            --border: #ddd;
            --shadow: rgba(0,0,0,0.1);
        }

        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            color: var(--dark);
            background: #fafbfc;
        }

        html {
            scroll-behavior: smooth;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .section-header {
            animation: fadeInUp 0.8s ease-out;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        .header {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid rgba(0, 179, 134, 0.1);
        }

        .nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.8rem 0;
        }

        .logo {
            display: flex;
            flex-direction: column;
            gap: 0;
            text-decoration: none;
            transition: transform 0.3s ease;
        }

        .logo:hover {
            transform: scale(1.05);
        }

        .logo-main {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        .logo-tagline {
            font-size: 0.75rem;
            color: var(--gray);
            font-weight: 400;
            margin-left: 32px;
            font-style: italic;
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 2rem;
            align-items: center;
        }

        .nav-links a {
            color: var(--dark);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }

        .nav-links a:hover {
            color: var(--primary);
        }

        .auth-section {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .btn {
            padding: 8px 16px;
            border-radius: 6px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
            font-size: 13px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: var(--white);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0, 179, 134, 0.3);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background: var(--primary);
            color: var(--white);
        }

        .btn-secondary {
            background: var(--secondary);
            color: var(--white);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.9rem;
        }

        .btn-large {
            padding: 16px 32px;
            font-size: 1.1rem;
        }

        .btn-danger {
            background: var(--danger);
            color: var(--white);
        }

        .btn-danger:hover {
            background: #e53e3e;
        }

        .btn-warning {
            background: var(--warning);
            color: var(--white);
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            color: var(--white);
            padding: 100px 0 30px;
            text-align: center;
        }

        .hero h1 {
            font-size: 2rem;
            margin-bottom: 0.8rem;
            font-weight: 700;
        }

        .hero p {
            font-size: 1rem;
            margin-bottom: 1.2rem;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            opacity: 0.95;
        }

        .hero-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        /* Trust Section */
        .trust-section {
            background: var(--white);
            padding: 15px 0;
            text-align: center;
        }

        .trust-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .stat-item {
            padding: 0.5rem 0.25rem;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.3rem;
        }

        .stat-label {
            color: var(--gray);
            font-weight: 500;
            font-size: 0.9rem;
        }

        /* Categories Section */
        .categories-section {
            padding: 40px 0;
            background: var(--light);
        }

        .section-header {
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .section-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--dark);
        }

        .section-subtitle {
            font-size: 1.2rem;
            color: var(--gray);
            max-width: 600px;
            margin: 0 auto;
        }

        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
        }

        .category-card {
            background: var(--white);
            padding: 2rem;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 20px var(--shadow);
            transition: transform 0.3s;
            cursor: pointer;
        }

        .category-card:hover {
            transform: translateY(-8px);
        }

        .category-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.5rem;
            font-size: 2rem;
            color: var(--white);
        }

        /* Campaigns Section */
        .campaigns-section {
            padding: 40px 0;
            background: var(--white);
        }

        .campaigns-filter {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 3rem;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 20px;
            border: 2px solid var(--border);
            background: var(--white);
            color: var(--gray);
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .filter-btn.active,
        .filter-btn:hover {
            border-color: var(--primary);
            background: var(--primary);
            color: var(--white);
        }

        /* Carousel Styles */
        .campaigns-carousel-container {
            position: relative;
            width: 100%;
            overflow: hidden;
            padding: 20px 0;
            max-width: 100%;
        }

        .campaigns-carousel {
            display: flex;
            transition: transform 0.5s ease-in-out;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .campaigns-carousel::-webkit-scrollbar {
            display: none;
        }

        .carousel-item {
            min-width: 100%;
            max-width: 100%;
            padding: 0 10px;
            flex-shrink: 0;
            box-sizing: border-box;
            scroll-snap-align: start;
        }

        @media (min-width: 768px) {
            .carousel-item {
                min-width: 33.333%;
                max-width: 33.333%;
            }
        }

        @media (max-width: 768px) {
            .carousel-item {
                min-width: 100%;
                max-width: 100%;
                padding: 0 10px;
            }
        }

        .campaign-card {
            background: var(--white);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
            height: 100%;
            position: relative;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .campaign-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 16px 48px rgba(0, 179, 134, 0.2);
            border-color: rgba(0, 179, 134, 0.2);
        }

        .campaign-image-container {
            position: relative;
            width: 100%;
            height: 220px;
            overflow: hidden;
        }

        .campaign-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s;
        }

        .campaign-card:hover .campaign-image {
            transform: scale(1.05);
        }

        .campaign-badge {
            position: absolute;
            top: 15px;
            left: 15px;
            background: var(--primary);
            color: var(--white);
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
        }

        .urgent-badge {
            background: var(--danger);
        }

        /* Declaration Box */
        .declaration-box {
            background-color: #ffa726;
            color: #000000;
            padding: 20px;
            border-radius: 12px;
            margin-top: 2rem;
            font-size: 0.95rem;
            border-left: 5px solid #f57c00;
            line-height: 1.7;
        }

        .declaration-box h4 {
            margin: 0 0 12px 0;
            font-size: 1.1rem;
            color: #000000;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .declaration-box h4 i {
            font-size: 1.2rem;
        }

        .declaration-box p {
            margin: 0;
            line-height: 1.7;
            color: #000000;
        }


        .campaign-content {
            padding: 1.5rem;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .campaign-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--dark);
            line-height: 1.4;
        }

        .campaign-organizer {
            color: var(--gray);
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .campaign-description {
            color: var(--gray);
            margin-bottom: 1.5rem;
            flex: 1;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .campaign-progress {
            margin-bottom: 1.5rem;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--success));
            border-radius: 4px;
            transition: width 0.3s;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
        }

        .amount-raised {
            font-weight: 600;
            color: var(--primary);
        }

        .campaign-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
            gap: 1rem;
        }

        .campaign-actions {
            display: flex;
            gap: 0.5rem;
            flex: 1;
        }

        .admin-actions {
            display: flex;
            gap: 0.5rem;
        }

        .delete-btn {
            background: var(--danger);
            color: var(--white);
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        /* Carousel Navigation Buttons */
        .carousel-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            padding: 10px;
            cursor: pointer;
            z-index: 10;
            border-radius: 50%;
            font-size: 1.2rem;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .carousel-nav.prev {
            left: 10px;
        }

        .carousel-nav.next {
            right: 10px;
        }

        .carousel-nav:hover {
            background-color: rgba(0, 0, 0, 0.8);
        }

        /* Image Preview Styles */
        .image-preview-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .image-preview-item {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            border: 2px solid var(--border);
        }

        .image-preview-item img {
            width: 100%;
            height: 80px;
            object-fit: cover;
        }

        .image-preview-remove {
            position: absolute;
            top: 4px;
            right: 4px;
            background: var(--danger);
            color: var(--white);
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 10px;
            cursor: pointer;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            backdrop-filter: blur(4px);
        }

        .modal-content {
            background-color: var(--white);
            margin: 2% auto;
            padding: 0;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal-header {
            padding: 2rem 2rem 1rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-body {
            padding: 2rem;
        }

        .close {
            color: var(--gray);
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s;
        }

        .close:hover {
            color: var(--danger);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* User Profile Dropdown */
        .user-menu {
            position: relative;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: 600;
            overflow: hidden;
            position: relative;
        }

        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: var(--white);
            box-shadow: 0 10px 30px var(--shadow);
            border-radius: 8px;
            min-width: 200px;
            padding: 0.5rem 0;
            display: none;
        }

        .dropdown-item {
            padding: 0.75rem 1rem;
            color: var(--dark);
            text-decoration: none;
            display: block;
            transition: background 0.3s;
        }

        .dropdown-item:hover {
            background: var(--light);
        }

        /* Profile Section */
        .profile-section {
            display: none;
            padding: 120px 0 80px;
            min-height: 100vh;
            background: var(--light);
        }

        .profile-section.active {
            display: block;
        }

        .profile-card {
            background: var(--white);
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 6px 25px var(--shadow);
            margin-bottom: 2rem;
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 2rem;
            margin-bottom: 2rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid var(--border);
        }

        .profile-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: var(--primary);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            font-weight: 600;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .profile-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .upload-overlay {
            position: absolute;
            bottom: 0;
            right: 0;
            background: var(--primary);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .profile-info h2 {
            margin-bottom: 0.5rem;
            color: var(--dark);
        }

        .profile-info p {
            color: var(--gray);
            margin-bottom: 0.25rem;
        }

        /* Verification Status */
        .verification-status {
            background: #fff3e0;
            border: 1px solid #f57c00;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .verification-status.verified {
            background: #e8f5e8;
            border-color: #2d5016;
        }

        .verification-status.pending {
            background: #fff3e0;
            border-color: #f57c00;
        }

        .verification-status.unverified {
            background: #ffebee;
            border-color: #d32f2f;
        }

        .verification-form {
            background: var(--white);
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 6px 25px var(--shadow);
            margin-bottom: 2rem;
        }

        .document-upload {
            border: 2px dashed var(--border);
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: border-color 0.3s;
        }

        .document-upload:hover {
            border-color: var(--primary);
        }

        .document-upload.has-file {
            border-color: var(--success);
            background: #e8f5e8;
        }

        /* Campaign Detail Page */
        .campaign-detail {
            display: none;
            padding: 120px 0 80px;
            min-height: 100vh;
            background: var(--light);
        }

        .campaign-detail.active {
            display: block;
        }

        .campaign-detail-card {
            background: var(--white);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 6px 25px var(--shadow);
            margin-bottom: 2rem;
        }

        .campaign-hero {
            position: relative;
            height: 400px;
            overflow: hidden;
        }

        .campaign-hero img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Tab Styles */
        .campaign-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 0;
            padding: 0 2rem;
            border-bottom: 2px solid var(--border);
        }

        .tab-btn {
            padding: 12px 20px;
            background: transparent;
            border: none;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--gray);
            cursor: pointer;
            transition: color 0.3s, border-bottom-color 0.3s;
        }

        .tab-btn.active {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
        }

        .tab-content {
            padding: 2rem;
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .campaign-info {
            padding: 2rem;
        }

        .campaign-detail-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--dark);
        }

        .campaign-meta {
            display: flex;
            gap: 2rem;
            margin-bottom: 1.5rem;
            color: var(--gray);
        }

        .campaign-story {
            font-size: 0.95rem;
            line-height: 1.6;
            color: var(--gray);
            margin-bottom: 1.5rem;
        }

        /* Payouts Section */
        .payout-item {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
            margin-bottom: 1rem;
            background-color: var(--light);
            border-radius: 8px;
        }

        .payout-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .payout-amount {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--primary);
        }

        .payout-date {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .payout-purpose {
            color: var(--dark);
            line-height: 1.7;
        }

        /* Updates Section */
        .update-item {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
            margin-bottom: 1rem;
            background-color: var(--light);
            border-radius: 8px;
        }

        .update-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .update-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--dark);
        }

        .update-date {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .update-text {
            color: var(--dark);
            line-height: 1.7;
        }


        .donors-section {
            background: var(--white);
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 6px 25px var(--shadow);
        }

        .donor-item {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .donor-info h4 {
            margin-bottom: 0.25rem;
        }

        .donor-amount {
            font-weight: 600;
            color: var(--primary);
        }

        /* Footer */
        .footer {
            background: var(--dark);
            color: var(--white);
            padding: 3rem 0 1rem;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .footer-section h3 {
            margin-bottom: 1rem;
            color: var(--primary);
            font-size: 1.2rem;
        }

        .footer-section p {
            color: #adb5bd;
            margin-bottom: 1rem;
            line-height: 1.6;
            font-size: 0.95rem;
        }

        .footer-section a {
            color: #adb5bd;
            text-decoration: none;
            display: block;
            margin-bottom: 0.5rem;
            transition: color 0.3s;
            padding: 0.25rem 0;
            font-size: 0.95rem;
        }

        .footer-section a:hover {
            color: var(--white);
        }

        .social-links {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }

        .social-links a {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            color: var(--white);
            transition: background 0.3s;
        }

        .social-links a:hover {
            background: var(--primary);
        }

        .copyright {
            text-align: center;
            padding-top: 2rem;
            border-top: 1px solid rgba(255,255,255,0.1);
            color: #adb5bd;
            font-size: 0.9rem;
        }

        .copyright p {
            margin-bottom: 0.5rem;
        }

        /* Admin Badge */
        .admin-badge {
            background: var(--warning);
            color: var(--white);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            margin-left: 1rem;
        }

        /* Success/Error Messages */
        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            color: var(--white);
            font-weight: 600;
            z-index: 3000;
            transform: translateX(100%);
            transition: transform 0.3s;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: var(--success);
        }

        .notification.error {
            background: var(--danger);
        }

        .notification.warning {
            background: var(--warning);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem 2rem;
            color: var(--gray);
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .empty-state h3 {
            margin-bottom: 1rem;
        }

        .empty-state p {
            margin-bottom: 2rem;
        }

        /* FAQ Section */
        .faq-section {
            padding: 80px 0;
            background: var(--light);
        }

        .faq-container {
            max-width: 900px;
            margin: 0 auto;
        }

        .faq-item {
            background: var(--white);
            border-radius: 12px;
            margin-bottom: 1rem;
            box-shadow: 0 2px 10px var(--shadow);
            overflow: hidden;
            transition: all 0.3s;
        }

        .faq-question {
            padding: 1.5rem;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--dark);
            transition: background 0.3s;
        }

        .faq-question:hover {
            background: var(--light);
        }

        .faq-question i {
            color: var(--primary);
            transition: transform 0.3s;
        }

        .faq-item.active .faq-question i {
            transform: rotate(180deg);
        }

        .faq-answer {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out, padding 0.3s;
            padding: 0 1.5rem;
        }

        .faq-item.active .faq-answer {
            max-height: 500px;
            padding: 0 1.5rem 1.5rem;
        }

        .faq-answer p {
            color: var(--gray);
            line-height: 1.8;
            margin-bottom: 0.5rem;
        }

        .faq-answer ul {
            color: var(--gray);
            margin-left: 1.5rem;
            line-height: 1.8;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }

            .hero h1 {
                font-size: 2.5rem;
            }

            .hero p {
                font-size: 1.1rem;
            }

            .btn-large {
                width: 100%;
                margin-bottom: 1rem;
            }

            .campaign-actions {
                flex-direction: column;
            }

            .campaign-detail-title {
                font-size: 2rem;
            }

            .campaign-meta {
                flex-direction: column;
                gap: 1rem;
            }

            .profile-header {
                flex-direction: column;
                text-align: center;
            }

            .faq-question {
                font-size: 1rem;
                padding: 1.25rem;
            }

            .carousel-item {
                min-width: 80%; /* Make items take more width on smaller screens */
            }

            .carousel-nav {
                width: 30px;
                height: 30px;
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <nav class="container">
            <div class="nav">
                <a href="#" class="logo" onclick="showHomePage()">
                    <div class="logo-main">
                        <i class="fas fa-hands-helping"></i>
                        Flapping Bird
                    </div>
                    <div class="logo-tagline">Give a chance to fly</div>
                </a>

                <ul class="nav-links">
                    <li><a href="#campaigns" onclick="showHomePage()">Browse Campaigns</a></li>
                    <li><a href="#how-it-works">How It Works</a></li>
                    <li><a href="#success-stories">Success Stories</a></li>
                    <li><a href="#about">About</a></li>
                </ul>

                <div class="auth-section" id="authSection">
                    <button class="btn btn-outline" onclick="openModal('loginModal')">Login</button>
                    <button class="btn btn-primary" onclick="openModal('signupModal')">Sign Up</button>
                </div>

                <!-- User Menu (hidden by default) -->
                <div class="user-menu" id="userMenu" style="display: none;">
                    <div class="user-avatar" onclick="toggleDropdown()" id="userAvatarNav">
                        <span id="userInitials">U</span>
                    </div>
                    <div class="dropdown-menu" id="dropdownMenu">
                        <a href="#" class="dropdown-item" onclick="showProfile()"><i class="fas fa-user"></i> Profile</a>
                        <a href="#" class="dropdown-item" onclick="showMyCampaigns()"><i class="fas fa-heart"></i> My Campaigns</a>
                        <a href="#" class="dropdown-item" onclick="showWithdrawals()"><i class="fas fa-wallet"></i> Withdrawals</a>
                        <a href="#" class="dropdown-item" onclick="showMyDonations()"><i class="fas fa-donate"></i> My Donations</a>
                        <a href="#" class="dropdown-item" onclick="showSettings()"><i class="fas fa-cog"></i> Settings</a>
                        <div id="adminMenuItems" style="display: none;">
                            <hr style="margin: 0.5rem 0;">
                            <a href="#" class="dropdown-item" onclick="showAdminPanel()"><i class="fas fa-shield-alt"></i> Admin Panel</a>
                        </div>
                        <hr style="margin: 0.5rem 0;">
                        <a href="#" class="dropdown-item" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</a>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <!-- Home Page -->
    <div id="homePage">
        <!-- Hero Section -->
        <section class="hero">
            <div class="container">
                <h1>India's Most Trusted Crowdfunding Platform</h1>
                <p>Join millions of Indians who have raised funds for medical emergencies, education, disasters, and social causes</p>
                <div class="hero-buttons">
                    <button class="btn btn-primary btn-large" onclick="checkAuthAndStartCampaign()" style="background: linear-gradient(135deg, #00b386, #009970); border: none; padding: 18px 40px; font-size: 1.15rem; border-radius: 50px; box-shadow: 0 4px 20px rgba(0, 179, 134, 0.4);">
                        Start a Free Fundraiser
                    </button>
                    <a href="#campaigns" class="btn btn-outline btn-large" style="border: 2px solid white; color: white; padding: 18px 40px; font-size: 1.15rem; border-radius: 50px; background: transparent;">
                        Browse Fundraisers
                    </a>
                </div>
            </div>
        </section>

        <!-- Trust Section -->
        <section class="trust-section">
            <div class="container">
                <h2>Trusted by Millions Across India</h2>
                <div class="trust-stats">
                    <div class="stat-item">
                        <div class="stat-number">₹6+ Cr</div>
                        <div class="stat-label">Funds Raised</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">1K+</div>
                        <div class="stat-label">Successful Campaigns</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">1L+</div>
                        <div class="stat-label">Happy Donors</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">50+</div>
                        <div class="stat-label">Cities Covered</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Categories Section -->
        <section class="categories-section" id="categories">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">Fundraise For Any Cause</h2>
                    <p class="section-subtitle">From medical emergencies to education, we support all genuine causes</p>
                </div>
                <div class="categories-grid">
                    <div class="category-card" onclick="filterCampaigns('medical')">
                        <div class="category-icon">
                            <i class="fas fa-heartbeat"></i>
                        </div>
                        <h3>Medical Emergencies</h3>
                        <p>Help patients get life-saving treatments and surgeries</p>
                    </div>
                    <div class="category-card" onclick="filterCampaigns('education')">
                        <div class="category-icon">
                            <i class="fas fa-graduation-cap"></i>
                        </div>
                        <h3>Education</h3>
                        <p>Support students with tuition fees, books, and educational expenses. Students can fundraise for college fees, textbooks, and study materials.</p>
                    </div>
                    <div class="category-card" onclick="filterCampaigns('students')">
                        <div class="category-icon">
                            <i class="fas fa-user-graduate"></i>
                        </div>
                        <h3>Students</h3>
                        <p>Special category for students raising funds for books, fees, equipment, and educational projects.</p>
                    </div>
                    <div class="category-card" onclick="filterCampaigns('disaster')">
                        <div class="category-icon">
                            <i class="fas fa-home"></i>
                        </div>
                        <h3>Disaster Relief</h3>
                        <p>Aid victims of natural disasters and emergencies</p>
                    </div>
                    <div class="category-card" onclick="filterCampaigns('debt')">
                        <div class="category-icon">
                            <i class="fas fa-balance-scale"></i>
                        </div>
                        <h3>Debt Relief</h3>
                        <p>Help families overcome financial burdens</p>
                    </div>
                    <div class="category-card" onclick="filterCampaigns('animal')">
                        <div class="category-icon">
                            <i class="fas fa-paw"></i>
                        </div>
                        <h3>Animal Welfare</h3>
                        <p>Support rescue and care for animals in need</p>
                    </div>
                    <div class="category-card" onclick="filterCampaigns('social')">
                        <div class="category-icon">
                            <i class="fas fa-hands-helping"></i>
                        </div>
                        <h3>Social Causes</h3>
                        <p>Make a difference in your community</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Success Stories Section -->
        <section class="categories-section" id="success-stories" style="background: var(--white);">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">Success Stories That Inspire</h2>
                    <p class="section-subtitle">Real people, real impact - see how your donations change lives</p>
                </div>

                <div class="campaigns-carousel-container">
                    <div class="campaigns-carousel" id="successStoriesCarousel">
                        <div class="carousel-item">
                            <div class="category-card" style="background: linear-gradient(135deg, #e8f5e8, #f0fff0); border: 1px solid var(--success); height: 100%;">
                                <div class="category-icon" style="background: linear-gradient(135deg, var(--success), #2d5016);">
                                    <i class="fas fa-heart"></i>
                                </div>
                                <h3>Priya's Heart Surgery - ₹12 Lakhs Raised</h3>
                                <p>"Thanks to 847 generous donors, our 6-year-old daughter got her life-saving heart surgery. She's now healthy and back to school. Forever grateful!" - Rajesh & Meera</p>
                                <small style="color: var(--success); font-weight: 600;">✓ Campaign Completed Successfully</small>
                            </div>
                        </div>
                        <div class="carousel-item">
                            <div class="category-card" style="background: linear-gradient(135deg, #e3f2fd, #f3e5f5); border: 1px solid var(--accent); height: 100%;">
                                <div class="category-icon" style="background: linear-gradient(135deg, var(--accent), #1976d2);">
                                    <i class="fas fa-graduation-cap"></i>
                                </div>
                                <h3>Arjun's Engineering Dream - ₹4 Lakhs Raised</h3>
                                <p>"A village boy's dream to become an engineer came true. Now I'm in my final year at IIT Delhi, all thanks to the kindness of 312 supporters who believed in education."</p>
                                <small style="color: var(--accent); font-weight: 600;">✓ Graduate in 2024</small>
                            </div>
                        </div>
                        <div class="carousel-item">
                            <div class="category-card" style="background: linear-gradient(135deg, #fff3e0, #ffeaa7); border: 1px solid var(--warning); height: 100%;">
                                <div class="category-icon" style="background: linear-gradient(135deg, var(--warning), #f57c00);">
                                    <i class="fas fa-home"></i>
                                </div>
                                <h3>Kerala Flood Relief - ₹25 Lakhs Raised</h3>
                                <p>"After losing everything in floods, 1,200+ donors helped us rebuild 45 homes. Families are back to their normal lives with dignity and hope restored."</p>
                                <small style="color: var(--warning); font-weight: 600;">✓ 45 Families Rehabilitated</small>
                            </div>
                        </div>
                        <div class="carousel-item">
                            <div class="category-card" style="background: linear-gradient(135deg, #ffebee, #fce4ec); border: 1px solid var(--secondary); height: 100%;">
                                <div class="category-icon" style="background: linear-gradient(135deg, var(--secondary), #c62828);">
                                    <i class="fas fa-paw"></i>
                                </div>
                                <h3>Shelter for 200 Stray Dogs - ₹8 Lakhs Raised</h3>
                                <p>"Our animal shelter was about to close, but 567 animal lovers came together to save it. Now 200+ rescued dogs have a safe home and medical care."</p>
                                <small style="color: var(--secondary); font-weight: 600;">✓ Shelter Operating Successfully</small>
                            </div>
                        </div>
                        <div class="carousel-item">
                            <div class="category-card" style="background: linear-gradient(135deg, #f3e5f5, #e8f5e8); border: 1px solid #9c27b0; height: 100%;">
                                <div class="category-icon" style="background: linear-gradient(135deg, #9c27b0, #6a1b9a);">
                                    <i class="fas fa-hand-holding-medical"></i>
                                </div>
                                <h3>Cancer Treatment for Grandmother - ₹15 Lakhs Raised</h3>
                                <p>"Dadi defeated cancer at 78! The treatment cost seemed impossible, but 923 kind souls made the miracle happen. She's cancer-free for 2 years now."</p>
                                <small style="color: #9c27b0; font-weight: 600;">✓ Cancer-Free for 2 Years</small>
                            </div>
                        </div>
                        <div class="carousel-item">
                            <div class="category-card" style="background: linear-gradient(135deg, #e0f2f1, #e8f5e8); border: 1px solid #00796b; height: 100%;">
                                <div class="category-icon" style="background: linear-gradient(135deg, #00796b, #004d40);">
                                    <i class="fas fa-seedling"></i>
                                </div>
                                <h3>Farmer Debt Relief - ₹6 Lakhs Raised</h3>
                                <p>"After three failed crops, we thought we'd lose our ancestral land. But 234 supporters helped clear our debt. This season's harvest was our best ever!"</p>
                                <small style="color: #00796b; font-weight: 600;">✓ Farm Saved, Family Secure</small>
                            </div>
                        </div>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 3rem;">
                    <p style="font-size: 1.2rem; color: var(--gray); margin-bottom: 2rem;">Your donation could be the next success story. Every contribution creates ripples of hope.</p>
                    <button class="btn btn-primary btn-large" onclick="scrollToCampaigns()">
                        <i class="fas fa-heart"></i> Be Part of a Success Story
                    </button>
                </div>
            </div>
        </section>

        <!-- Campaigns Section -->
        <section class="campaigns-section" id="campaigns">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">Featured Campaigns</h2>
                    <p class="section-subtitle">Support these urgent campaigns that need your help today</p>
                </div>

                <div class="campaigns-filter">
                    <button class="filter-btn active" data-filter="all">All Campaigns</button>
                    <button class="filter-btn" data-filter="medical">Medical</button>
                    <button class="filter-btn" data-filter="education">Education</button>
                    <button class="filter-btn" data-filter="students">Students</button>
                    <button class="filter-btn" data-filter="disaster">Emergency</button>
                    <button class="filter-btn" data-filter="debt">Debt Relief</button>
                    <button class="filter-btn" data-filter="animal">Animals</button>
                </div>

                <!-- Carousel Container -->
                <div class="campaigns-carousel-container">
                    <div class="campaigns-carousel" id="campaignsCarousel">
                        <!-- Campaigns will be loaded here by JavaScript -->
                    </div>
                    <!-- Navigation buttons will be added by JS -->
                </div>
            </div>
        </section>
    </div>

    <!-- Profile Section -->
    <section class="profile-section" id="profileSection">
        <div class="container">
            <button class="btn btn-outline" onclick="showHomePage()" style="margin-bottom: 2rem;">
                <i class="fas fa-arrow-left"></i> Back to Home
            </button>

            <div class="profile-card">
                <div class="profile-header">
                    <div class="profile-avatar" id="profileAvatar" onclick="uploadProfilePicture()">
                        <span id="profileInitials">U</span>
                        <div class="upload-overlay">
                            <i class="fas fa-camera" style="color: white; font-size: 12px;"></i>
                        </div>
                    </div>
                    <input type="file" id="profilePictureInput" accept="image/*" style="display: none;" onchange="handleProfilePictureUpload(event)">
                    <div class="profile-info">
                        <h2 id="profileName">User Name</h2>
                        <p id="profileEmail">user@example.com</p>
                        <p id="profilePhone">+91-9876543210</p>
                        <button class="btn btn-outline btn-small" onclick="editProfile()">
                            <i class="fas fa-edit"></i> Edit Profile
                        </button>
                    </div>
                </div>

                <!-- Verification Status -->
                <div id="verificationStatus" class="verification-status unverified">
                    <h4><i class="fas fa-exclamation-triangle"></i> Account Verification Required</h4>
                    <p>Please complete your profile verification to start fundraising and withdraw funds.</p>
                    <button class="btn btn-warning btn-small" onclick="showVerificationForm()">
                        <i class="fas fa-shield-alt"></i> Complete Verification
                    </button>
                </div>

                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                    <h2><i class="fas fa-heart"></i> My Campaigns</h2>
                    <button class="btn btn-primary" onclick="checkAuthAndStartCampaign()">
                        <i class="fas fa-plus"></i> Create New Campaign
                    </button>
                </div>

                <div id="userCampaignsList">
                    <div class="empty-state">
                        <i class="fas fa-heart-broken"></i>
                        <h3>No Campaigns Yet</h3>
                        <p>You haven't created any campaigns yet. Start your first fundraiser to make a difference!</p>
                        <button class="btn btn-primary" onclick="checkAuthAndStartCampaign()">
                            <i class="fas fa-plus"></i> Create Your First Campaign
                        </button>
                    </div>
                </div>
            </div>
        </section>

    <!-- Verification Section -->
    <section class="profile-section" id="verificationSection">
        <div class="container">
            <button class="btn btn-outline" onclick="showProfile()" style="margin-bottom: 2rem;">
                <i class="fas fa-arrow-left"></i> Back to Profile
            </button>

            <div class="verification-form">
                <h2><i class="fas fa-shield-alt"></i> Complete Account Verification</h2>
                <p style="color: var(--gray); margin-bottom: 2rem;">Verify your identity to start fundraising and enable fund withdrawals. All information is encrypted and secure.</p>

                <form id="verificationForm">
                    <div style="background: #ffebee; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem; border-left: 4px solid #d32f2f;">
                        <h4 style="margin: 0 0 0.5rem 0; color: #d32f2f;"><i class="fas fa-exclamation-circle"></i> Mandatory for Withdrawals</h4>
                        <p style="margin: 0; color: #c62828; font-size: 0.9rem;">Aadhaar and PAN card verification is compulsory before you can withdraw any funds. Please ensure documents are clear and readable.</p>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Aadhaar Number <span style="color: red;">*</span></label>
                        <input type="text" class="form-control" id="aadhaarNumber" placeholder="Enter 12-digit Aadhaar number" maxlength="12" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Upload Aadhaar Card (Front & Back) <span style="color: red;">*</span></label>
                        <div class="document-upload" id="aadhaarUploadDiv" onclick="document.getElementById('aadhaarUpload').click()">
                            <i class="fas fa-cloud-upload-alt" style="font-size: 2rem; color: var(--gray); margin-bottom: 1rem;"></i>
                            <p>Click to upload Aadhaar card image</p>
                            <small>JPG, PNG or PDF (Max 5MB)</small>
                        </div>
                        <input type="file" id="aadhaarUpload" accept="image/*,.pdf" style="display: none;" onchange="handleDocumentUpload(this, 'aadhaar')" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">PAN Number <span style="color: red;">*</span></label>
                        <input type="text" class="form-control" id="panNumber" placeholder="Enter PAN number" maxlength="10" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Upload PAN Card <span style="color: red;">*</span></label>
                        <div class="document-upload" id="panUploadDiv" onclick="document.getElementById('panUpload').click()">
                            <i class="fas fa-cloud-upload-alt" style="font-size: 2rem; color: var(--gray); margin-bottom: 1rem;"></i>
                            <p>Click to upload PAN card image</p>
                            <small>JPG, PNG or PDF (Max 5MB)</small>
                        </div>
                        <input type="file" id="panUpload" accept="image/*,.pdf" style="display: none;" onchange="handleDocumentUpload(this, 'pan')" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Bank Account Number</label>
                        <input type="text" class="form-control" id="bankAccount" placeholder="Enter bank account number" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">IFSC Code</label>
                        <input type="text" class="form-control" id="ifscCode" placeholder="Enter IFSC code" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Bank Name</label>
                        <input type="text" class="form-control" id="bankName" placeholder="Enter bank name" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Account Holder Name</label>
                        <input type="text" class="form-control" id="accountHolderName" placeholder="Enter account holder name" required>
                    </div>

                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        <i class="fas fa-check"></i> Submit for Verification
                    </button>
                </form>
            </div>
        </div>
    </section>

    <!-- Withdrawals Section -->
    <section class="profile-section" id="withdrawalsSection">
        <div class="container">
            <button class="btn btn-outline" onclick="showProfile()" style="margin-bottom: 2rem;">
                <i class="fas fa-arrow-left"></i> Back to Profile
            </button>

            <div class="profile-card">
                <h2><i class="fas fa-wallet"></i> Fund Withdrawals</h2>

                <div id="withdrawalNotice" class="verification-status unverified">
                    <h4><i class="fas fa-exclamation-triangle"></i> Verification Required</h4>
                    <p>Complete your account verification to enable withdrawals. All withdrawals are subject to verification and require proper documentation.</p>
                    <button class="btn btn-warning btn-small" onclick="showVerificationForm()">
                        <i class="fas fa-shield-alt"></i> Complete Verification
                    </button>
                </div>

                <div id="withdrawalContent" style="display: none;">
                    <div style="background: #fff3e0; padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem; border-left: 4px solid #f57c00;">
                        <h4 style="margin: 0 0 1rem 0; color: #f57c00;">Important: Withdrawal Process</h4>
                        <ul style="margin: 0; padding-left: 1.5rem; color: #f57c00;">
                            <li>All withdrawals are subject to verification</li>
                            <li>Upload bills/receipts when requesting withdrawals</li>
                            <li>Funds will be transferred to your verified bank account</li>
                            <li>Platform fee: 5% of withdrawn amount</li>
                            <li>Minimum withdrawal amount: ₹1,000</li>
                        </ul>
                    </div>

                    <button class="btn btn-primary" onclick="openModal('withdrawalModal')">
                        <i class="fas fa-money-bill"></i> Request Withdrawal
                    </button>

                    <div style="margin-top: 2rem;">
                        <h3>Withdrawal History</h3>
                        <div id="withdrawalHistory">
                            <div class="empty-state">
                                <i class="fas fa-history"></i>
                                <h3>No Withdrawals Yet</h3>
                                <p>Your withdrawal history will appear here.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- My Donations Section -->
    <section class="profile-section" id="myDonationsSection">
        <div class="container">
            <button class="btn btn-outline" onclick="showProfile()" style="margin-bottom: 2rem;">
                <i class="fas fa-arrow-left"></i> Back to Profile
            </button>

            <div class="profile-card">
                <h2><i class="fas fa-donate"></i> My Donations</h2>

                <div id="userDonationsList">
                    <!-- Donations will be loaded here -->
                </div>
            </div>
        </div>
    </section>

    <!-- Settings Section -->
    <section class="profile-section" id="settingsSection">
        <div class="container">
            <button class="btn btn-outline" onclick="showProfile()" style="margin-bottom: 2rem;">
                <i class="fas fa-arrow-left"></i> Back to Profile
            </button>

            <div id="settingsContent">
                <!-- Settings content will be loaded here -->
            </div>
        </div>
    </section>

    <!-- Campaign Detail Page -->
    <div class="campaign-detail" id="campaignDetail">
        <div class="container">
            <button class="btn btn-outline" onclick="backToCampaigns()" style="margin-bottom: 2rem;">
                <i class="fas fa-arrow-left"></i> Back to Campaigns
            </button>

            <div class="campaign-detail-card">
                <div class="campaign-hero">
                    <div id="campaignImagesCarousel" style="position: relative; width: 100%; height: 100%; display: flex; overflow-x: auto; scroll-snap-type: x mandatory;">
                        <!-- Images will be inserted here -->
                    </div>
                    <div class="campaign-badge" id="detailCampaignBadge">ACTIVE</div>
                </div>

                <div class="campaign-info">
                    <h1 class="campaign-detail-title" id="detailCampaignTitle"></h1>

                    <div class="campaign-meta">
                        <div><i class="fas fa-user"></i> <span id="detailCampaignOrganizer"></span></div>
                        <div><i class="fas fa-map-marker-alt"></i> <span id="detailCampaignLocation"></span></div>
                        <div><i class="fas fa-calendar"></i> <span id="detailCampaignDate"></span></div>
                    </div>

                    <p class="campaign-story" id="detailCampaignStory"></p>

                    <div class="campaign-progress" style="margin-bottom: 2rem;">
                        <div class="progress-bar">
                            <div class="progress-fill" id="detailProgressFill"></div>
                        </div>
                        <div class="progress-info">
                            <span class="amount-raised" id="detailAmountRaised">₹0</span>
                            <span id="detailGoalAmount">₹0</span>
                        </div>
                        <div class="progress-info">
                            <span id="detailDonorCount">0 donors</span>
                            <span id="detailDaysLeft">0 days left</span>
                        </div>
                    </div>

                    <div style="display: flex; gap: 1rem; margin-bottom: 2rem;">
                        <button class="btn btn-primary btn-large" onclick="openDonationModal()" style="flex: 1;">
                            <i class="fas fa-heart"></i> Donate Now
                        </button>
                        <button class="btn btn-outline" onclick="shareCampaign()">
                            <i class="fas fa-share-alt"></i> Share
                        </button>
                    </div>
                </div>

                <div class="campaign-tabs">
                    <button class="tab-btn active" onclick="showTab('storyTab')">Story</button>
                    <button class="tab-btn" onclick="showTab('payoutsTab')">Payouts (<span id="payoutCount">0</span>)</button>
                    <button class="tab-btn" onclick="showTab('updatesTab')">Updates (<span id="updateCount">0</span>)</button>
                </div>

                <div class="campaign-info" style="padding-top: 0;">
                    <!-- Story Tab -->
                    <div class="tab-content active" id="storyTab">
                        <p style="color: var(--dark); font-size: 1.05rem; line-height: 1.8;" id="detailCampaignStoryFull"></p>
                    </div>

                    <!-- Payouts Tab -->
                    <div class="tab-content" id="payoutsTab">
                        <div id="payoutsList">
                            <!-- Payouts will be loaded here -->
                        </div>
                        <div id="addPayoutSection" style="display: none; margin-top: 2rem; padding: 1.5rem; background: var(--light); border-radius: 8px;">
                            <h3>Add New Payout</h3>
                            <form id="addPayoutForm">
                                <div class="form-group">
                                    <label class="form-label">Payout Amount (₹)</label>
                                    <input type="number" class="form-control" id="payoutAmount" min="1000" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Purpose</label>
                                    <textarea class="form-control" id="payoutPurpose" rows="3" required></textarea>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Date</label>
                                    <input type="datetime-local" class="form-control" id="payoutDate" required>
                                </div>
                                <button type="submit" class="btn btn-primary">Add Payout</button>
                            </form>
                        </div>
                    </div>

                    <!-- Updates Tab -->
                    <div class="tab-content" id="updatesTab">
                        <div id="updatesList">
                            <!-- Updates will be loaded here -->
                        </div>
                        <div id="addUpdateSection" style="display: none; margin-top: 2rem; padding: 1.5rem; background: var(--light); border-radius: 8px;">
                            <h3>Add New Update</h3>
                            <form id="addUpdateForm">
                                <div class="form-group">
                                    <label class="form-label">Update Title</label>
                                    <input type="text" class="form-control" id="updateTitle" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Update Message</label>
                                    <textarea class="form-control" id="updateText" rows="4" required></textarea>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Date</label>
                                    <input type="datetime-local" class="form-control" id="updateDate" required>
                                </div>
                                <button type="submit" class="btn btn-primary">Add Update</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <div class="donors-section">
                <h2 style="margin-bottom: 1.5rem;"><i class="fas fa-users"></i> Recent Donors</h2>
                <div id="donorsList">
                    <!-- Donors will be loaded here -->
                </div>

                <!-- Declaration Box -->
                <div class="declaration-box">
                    <h4><i class="fas fa-info-circle"></i> Important Declaration</h4>
                    <p>All campaign information is provided by the organizer. Flapping Bird does not verify medical conditions or treatment recommendations. Please use your discretion before donating. The platform does not influence treatment decisions and is not responsible for medical outcomes.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Panel -->
    <div class="campaign-detail" id="adminPanel">
        <div class="container">
            <button class="btn btn-outline" onclick="showHomePage()" style="margin-bottom: 2rem;">
                <i class="fas fa-arrow-left"></i> Back to Home
            </button>

            <div class="campaign-detail-card">
                <div class="campaign-info">
                    <h1 class="campaign-detail-title">
                        <i class="fas fa-shield-alt"></i> Admin Panel
                        <span class="admin-badge">ADMIN</span>
                    </h1>

                    <div style="margin-bottom: 2rem;">
                        <h3>Pending Campaign Approvals</h3>
                        <div id="pendingCampaigns">
                            <!-- Pending campaigns will be loaded here -->
                        </div>
                    </div>

                    <div>
                        <h3>All Campaigns</h3>
                        <div id="allCampaignsAdmin">
                            <!-- All campaigns will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-sign-in-alt"></i> Login to Your Account</h2>
                <span class="close" onclick="closeModal('loginModal')">&times;</span>
            </div>
            <div class="modal-body">
                <form id="loginForm">
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-control" id="loginEmail" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <input type="password" class="form-control" id="loginPassword" required>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Login</button>
                </form>
                <p style="text-align: center; margin-top: 1rem;">
                    Don't have an account? <a href="#" onclick="closeModal('loginModal'); openModal('signupModal')">Sign up</a>
                </p>
            </div>
        </div>
    </div>

    <!-- Signup Modal -->
    <div id="signupModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-user-plus"></i> Create Your Account</h2>
                <span class="close" onclick="closeModal('signupModal')">&times;</span>
            </div>
            <div class="modal-body">
                <form id="signupForm">
                    <div class="form-group">
                        <label class="form-label">Full Name</label>
                        <input type="text" class="form-control" id="signupName" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-control" id="signupEmail" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Phone Number</label>
                        <input type="tel" class="form-control" id="signupPhone" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <input type="password" class="form-control" id="signupPassword" required>
                        <small style="color: #666;">Minimum 6 characters</small>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Send OTP</button>
                </form>
                <p style="text-align: center; margin-top: 1rem;">
                    Already have an account? <a href="#" onclick="closeModal('signupModal'); openModal('loginModal')">Login</a>
                </p>
            </div>
        </div>
    </div>

    <!-- OTP Verification Modal -->
    <div id="otpModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-shield-alt"></i> Verify Your Email</h2>
                <span class="close" onclick="closeModal('otpModal'); openModal('signupModal')">&times;</span>
            </div>
            <div class="modal-body">
                <div style="text-align: center; margin-bottom: 2rem;">
                    <div style="background: var(--light); padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem;">
                        <i class="fas fa-envelope" style="font-size: 3rem; color: var(--primary); margin-bottom: 1rem;"></i>
                        <p>We've sent a 6-digit OTP to:</p>
                        <p style="font-weight: 600; color: var(--primary);" id="otpEmail">user@example.com</p>
                        <p style="color: var(--gray); font-size: 0.9rem;">Please check your inbox (and spam folder) for the verification code.</p>

                        <!-- Email instructions -->
                        <div style="background: #e8f5e8; border: 1px solid #4caf50; border-radius: 8px; padding: 1rem; margin-top: 1rem;">
                            <p style="color: #2e7d32; font-weight: 600; margin: 0;"><i class="fas fa-envelope"></i> Check Your Email</p>
                            <p style="color: #2e7d32; font-size: 0.9rem; margin: 0.5rem 0 0 0;">The OTP has been sent to your email address. Please check your spam folder if you don't see it in your inbox.</p>
                        </div>
                    </div>
                </div>

                <form id="otpForm">
                    <div class="form-group">
                        <label class="form-label">Enter 6-Digit OTP</label>
                        <input type="text" class="form-control" id="otpCode" placeholder="Enter OTP" maxlength="6" style="text-align: center; font-size: 1.5rem; letter-spacing: 0.5rem;" required>
                    </div>

                    <div style="text-align: center; margin: 1rem 0;">
                        <p style="color: var(--gray);">
                            Time remaining: <span id="otpTimer" style="font-weight: 600; color: var(--primary);">15:00</span>
                        </p>
                        <button type="button" id="resendOTP" class="btn btn-outline btn-small" onclick="resendOTP()" style="display: none;">
                            <i class="fas fa-redo"></i> Resend OTP
                        </button>
                    </div>

                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        <i class="fas fa-check"></i> Verify & Create Account
                    </button>
                </form>

                <p style="text-align: center; margin-top: 1.5rem; color: var(--gray); font-size: 0.9rem;">
                    Didn't receive the email? Check your spam folder or click resend after the timer expires.
                </p>
            </div>
        </div>
    </div>

    <!-- Campaign Creation Modal -->
    <div id="createCampaignModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2><i class="fas fa-plus-circle"></i> Start Your Fundraiser</h2>
                <span class="close" onclick="closeModal('createCampaignModal')">&times;</span>
            </div>
            <div class="modal-body">
                <form id="campaignForm">
                    <div class="form-group">
                        <label class="form-label">Campaign Title</label>
                        <input type="text" class="form-control" name="title" placeholder="e.g., Help Priya Fight Cancer" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Category</label>
                        <select class="form-control" name="category" required>
                            <option value="">Select Category</option>
                            <option value="medical">Medical Emergency</option>
                            <option value="education">Education</option>
                            <option value="students">Students (Books, Fees, Equipment)</option>
                            <option value="disaster">Disaster Relief</option>
                            <option value="debt">Debt Relief</option>
                            <option value="animal">Animal Welfare</option>
                            <option value="social">Social Cause</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Funding Goal (₹)</label>
                        <input type="number" class="form-control" name="goal" min="10000" placeholder="Enter amount needed" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Location</label>
                        <input type="text" class="form-control" name="location" placeholder="City, State" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Campaign Duration</label>
                        <select class="form-control" name="duration" required>
                            <option value="">Select Duration</option>
                            <option value="30">30 days</option>
                            <option value="60">60 days</option>
                            <option value="90">90 days</option>
                            <option value="ongoing">Keep running until goal is met</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Your Story</label>
                        <textarea class="form-control" name="description" rows="6" placeholder="Tell people why you're raising funds. Include specific details about how the money will be used." required></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Upload Campaign Images (Maximum 5)</label>
                        <input type="file" id="campaignImages" class="form-control" accept="image/*" multiple onchange="previewCampaignImages(event)">
                        <small style="color: #666; display: block; margin-top: 0.5rem;">Upload clear photos that show the situation. Medical campaigns should include hospital documents. Each image should be under 600KB.</small>
                        <div id="imagePreview" class="image-preview-container"></div>
                    </div>

                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        <i class="fas fa-rocket"></i> Create Campaign
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Withdrawal Modal -->
    <div id="withdrawalModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2><i class="fas fa-money-bill"></i> Request Withdrawal</h2>
                <span class="close" onclick="closeModal('withdrawalModal')">&times;</span>
            </div>
            <div class="modal-body">
                <form id="withdrawalForm">
                    <div class="form-group">
                        <label class="form-label">Select Campaign</label>
                        <select class="form-control" id="withdrawalCampaign" required>
                            <option value="">Select campaign to withdraw from</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Withdrawal Amount (₹)</label>
                        <input type="number" class="form-control" id="withdrawalAmount" min="1000" placeholder="Minimum ₹1,000" required>
                        <small style="color: #666;">Platform fee: 5% will be deducted</small>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Purpose of Withdrawal</label>
                        <textarea class="form-control" id="withdrawalPurpose" placeholder="Describe how the funds will be used..." required></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Upload Supporting Documents</label>
                        <input type="file" id="withdrawalDocuments" class="form-control" accept="image/*,.pdf" multiple>
                        <small style="color: #666;">Upload bills, receipts, or medical reports (Max 5 files)</small>
                    </div>

                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        <i class="fas fa-send"></i> Submit Withdrawal Request
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Donation Modal -->
    <div id="donationModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2><i class="fas fa-heart"></i> Make a Donation</h2>
                <span class="close" onclick="closeModal('donationModal')">&times;</span>
            </div>
            <div class="modal-body">
                <div id="donationCampaignInfo" style="margin-bottom: 2rem;"></div>

                <form id="donationForm">
                    <div class="form-group">
                        <label class="form-label">Donation Amount (₹)</label>
                        <div style="display: flex; gap: 1rem; margin-bottom: 1rem; flex-wrap: wrap;">
                            <button type="button" class="btn btn-outline btn-small" onclick="setDonationAmount(500)">₹500</button>
                            <button type="button" class="btn btn-outline btn-small" onclick="setDonationAmount(1000)">₹1,000</button>
                            <button type="button" class="btn btn-outline btn-small" onclick="setDonationAmount(2500)">₹2,500</button>
                            <button type="button" class="btn btn-outline btn-small" onclick="setDonationAmount(5000)">₹5,000</button>
                        </div>
                        <input type="number" class="form-control" id="donationAmount" placeholder="Enter custom amount" min="100" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Your Name</label>
                        <input type="text" class="form-control" id="donorName" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Your Email</label>
                        <input type="email" class="form-control" id="donorEmail" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Message (Optional)</label>
                        <textarea class="form-control" id="donorMessage" placeholder="Write an encouraging message..."></textarea>
                    </div>

                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        <i class="fas fa-heart"></i> Donate Now
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Admin Campaign Edit Modal -->
    <div id="adminEditModal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2><i class="fas fa-shield-alt"></i> Admin: Edit Campaign</h2>
                <span class="close" onclick="closeModal('adminEditModal')">&times;</span>
            </div>
            <div class="modal-body">
                <form id="adminEditForm">
                    <div class="form-group">
                        <label class="form-label">Campaign Title</label>
                        <input type="text" class="form-control" id="adminEditTitle" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Campaign Description</label>
                        <textarea class="form-control" id="adminEditDescription" rows="4" required></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Funding Goal (₹)</label>
                        <input type="number" class="form-control" id="adminEditGoal" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Campaign Image URL</label>
                        <input type="url" class="form-control" id="adminEditImage" placeholder="https://example.com/image.jpg">
                        <small style="color: #666;">Enter a valid image URL for the campaign cover photo</small>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Payment Link (UPI/Bank/Razorpay)</label>
                        <input type="text" class="form-control" id="adminEditPaymentLink" placeholder="e.g., upi://pay?pa=example@okaxis&pn=Name&am=100">
                        <small style="color: #666;">Add payment links for easy donations (UPI, bank transfer, payment gateway)</small>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Campaign Start Date</label>
                        <input type="datetime-local" class="form-control" id="adminEditStartDate">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Campaign Status</label>
                        <select class="form-control" id="adminEditStatus">
                            <option value="pending">Pending Approval</option>
                            <option value="active">Active</option>
                            <option value="completed">Completed</option>
                            <option value="suspended">Suspended</option>
                        </select>
                    </div>

                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- FAQ Section -->
    <section class="faq-section" id="faq">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Frequently Asked Questions</h2>
                <p class="section-subtitle">Find answers to common questions about crowdfunding on Flapping Bird</p>
            </div>

            <div class="faq-container">
                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFAQ(this)">
                        <span>How does Flapping Bird work?</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p>Flapping Bird is a crowdfunding platform that connects people in need with generous donors across India. Here's how it works:</p>
                        <ul>
                            <li>Create a campaign by sharing your story and funding goal</li>
                            <li>Share your campaign with friends, family, and social networks</li>
                            <li>Receive donations directly to your verified bank account</li>
                            <li>Withdraw funds as needed with proper documentation</li>
                        </ul>
                        <p>Our platform charges a 5% platform fee to maintain operations and ensure secure transactions.</p>
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFAQ(this)">
                        <span>Is my donation tax-deductible?</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p>Tax deductibility depends on the type of campaign and the recipient's status:</p>
                        <ul>
                            <li>Donations to registered NGOs and charitable organizations are typically tax-deductible under Section 80G</li>
                            <li>Personal campaigns (medical, education, etc.) are usually not tax-deductible</li>
                            <li>We provide donation receipts for all contributions</li>
                        </ul>
                        <p>Please consult with your tax advisor for specific guidance on your donations.</p>
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFAQ(this)">
                        <span>How long does it take to receive funds?</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p>Fund transfer timelines:</p>
                        <ul>
                            <li>Withdrawal requests are processed within 3-5 business days</li>
                            <li>First withdrawal requires account verification (Aadhaar, PAN, Bank details)</li>
                            <li>Supporting documents (bills, receipts) must be uploaded with each withdrawal request</li>
                            <li>Urgent medical cases may receive expedited processing upon admin review</li>
                        </ul>
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFAQ(this)">
                        <span>What payment methods are accepted?</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p>We accept multiple payment methods for your convenience:</p>
                        <ul>
                            <li>Credit/Debit Cards (Visa, MasterCard, RuPay)</li>
                            <li>UPI (Google Pay, PhonePe, Paytm, etc.)</li>
                            <li>Net Banking from all major banks</li>
                            <li>Digital Wallets (Paytm, Mobikwik, etc.)</li>
                            <li>International payments via credit card</li>
                        </ul>
                        <p>All transactions are secured with 256-bit SSL encryption.</p>
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFAQ(this)">
                        <span>Can I get a refund if I donate by mistake?</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p>Our refund policy:</p>
                        <ul>
                            <li>Refund requests must be made within 24 hours of donation</li>
                            <li>Contact our support team with your transaction details</li>
                            <li>Refunds are processed within 7-10 business days</li>
                            <li>Platform fees are non-refundable</li>
                        </ul>
                        <p>Please email support@flappingbird.in with your request.</p>
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFAQ(this)">
                        <span>How do I verify my account?</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p>Account verification is required to create campaigns and withdraw funds:</p>
                        <ul>
                            <li>Upload clear photos of your Aadhaar card (front and back)</li>
                            <li>Provide PAN card details</li>
                            <li>Add bank account information (account number, IFSC code)</li>
                            <li>Verification is typically completed within 2-3 business days</li>
                        </ul>
                        <p>All information is encrypted and stored securely.</p>
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFAQ(this)">
                        <span>Can students create campaigns for education?</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p>Yes! Students can create campaigns for:</p>
                        <ul>
                            <li>College/University tuition fees</li>
                            <li>Books and study materials</li>
                            <li>Hostel and accommodation expenses</li>
                            <li>Course certifications and skill development</li>
                            <li>Educational projects and research</li>
                        </ul>
                        <p>Students must provide admission letters, fee receipts, or other relevant documents for verification.</p>
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFAQ(this)">
                        <span>What happens if my campaign doesn't reach its goal?</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p>Flapping Bird uses a "Keep What You Raise" model:</p>
                        <ul>
                            <li>You receive all funds raised, even if you don't meet your goal</li>
                            <li>Partial funding can still help with expenses</li>
                            <li>You can extend campaign duration or adjust your goal</li>
                            <li>Continue sharing to increase visibility and donations</li>
                        </ul>
                        <p>Many campaigns receive donations even after the initial deadline passes.</p>
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFAQ(this)">
                        <span>How can I increase my campaign's visibility?</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p>Tips to boost your campaign:</p>
                        <ul>
                            <li>Share regularly on social media (Facebook, WhatsApp, Instagram)</li>
                            <li>Add clear, high-quality photos and videos</li>
                            <li>Write a compelling story with specific details</li>
                            <li>Post updates about your progress</li>
                            <li>Thank donors publicly (with their permission)</li>
                            <li>Contact local media for human interest stories</li>
                        </ul>
                        <p>Campaigns with regular updates receive 3x more donations on average.</p>
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFAQ(this)">
                        <span>Is my personal information safe?</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p>We take data security seriously:</p>
                        <ul>
                            <li>All data is encrypted with industry-standard SSL/TLS protocols</li>
                            <li>Payment processing through secure, PCI-compliant gateways</li>
                            <li>We never share personal information without consent</li>
                            <li>Two-factor authentication for account security</li>
                            <li>Regular security audits and updates</li>
                        </ul>
                        <p>Read our Privacy Policy for complete details on data protection.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>About Flapping Bird</h3>
                    <p>India's most trusted crowdfunding platform helping millions raise funds for medical emergencies, education, and social causes. We believe in the power of collective giving to create positive change in society.</p>
                    <div class="social-links">
                        <a href="#" title="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" title="Twitter"><i class="fab fa-twitter"></i></a>
                        <a href="#" title="Instagram"><i class="fab fa-instagram"></i></a>
                        <a href="#" title="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                        <a href="#" title="YouTube"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>

                <div class="footer-section">
                    <h3>Campaigns</h3>
                    <a href="#" onclick="filterCampaigns('medical')">Medical Fundraising</a>
                    <a href="#" onclick="filterCampaigns('education')">Education Fundraising</a>
                    <a href="#" onclick="filterCampaigns('disaster')">Emergency Relief</a>
                    <a href="#" onclick="filterCampaigns('animal')">Animal Welfare</a>
                    <a href="#success-stories" onclick="document.getElementById('success-stories').scrollIntoView({behavior: 'smooth'})">Success Stories</a>
                </div>

                <div class="footer-section">
                    <h3>Support</h3>
                    <a href="#" onclick="openInfoModal('howItWorks')">How It Works</a>
                    <a href="#faq" onclick="document.getElementById('faq').scrollIntoView({behavior: 'smooth'})">FAQs</a>
                    <a href="#" onclick="openInfoModal('safety')">Safety & Security</a>
                    <a href="#" onclick="openInfoModal('pricing')">Pricing & Fees</a>
                    <a href="#" onclick="openInfoModal('help')">Help Center</a>
                    <a href="#" onclick="openInfoModal('contact')">Contact Support</a>
                </div>

                <div class="footer-section">
                    <h3>Legal</h3>
                    <a href="#" onclick="openInfoModal('terms')">Terms of Service</a>
                    <a href="#" onclick="openInfoModal('privacy')">Privacy Policy</a>
                    <a href="#" onclick="openInfoModal('refund')">Refund Policy</a>
                    <a href="#" onclick="openInfoModal('guidelines')">Campaign Guidelines</a>
                    <a href="#" onclick="openInfoModal('tax')">Tax Benefits</a>
                </div>
            </div>

            <div class="copyright">
                <p>&copy; 2024 Flapping Bird Technologies Pvt Ltd. All rights reserved. | CIN: U74999MH2024PTC123456</p>
                <p>Registered Office: 123 Tech Hub, Sector 18, Gurugram, Haryana 122015 | Support: +91-124-4567890 | Email: support@flappingbird.in</p>
            </div>
        </div>
    </footer>

    <!-- Info Modal -->
    <div id="infoModal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2 id="infoModalTitle"><i id="infoModalIcon"></i> Information</h2>
                <span class="close" onclick="closeModal('infoModal')">&times;</span>
            </div>
            <div class="modal-body">
                <div id="infoModalBody">
                    <!-- Content will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- EmailJS SDK -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script type="text/javascript">
        (function(){
            emailjs.init("9xuGthPm0Uw3wvgiX"); // Your public key
        })();
    </script>

    <!-- Firebase SDK -->
    <script type="module">
        // Firebase Configuration
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js';
        import { getFirestore, collection, addDoc, updateDoc, deleteDoc, doc, getDoc, getDocs, setDoc, query, where, orderBy, limit, onSnapshot } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js';
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js';
        import { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-storage.js';
        import { getAnalytics } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-analytics.js';

        const firebaseConfig = {
            apiKey: "AIzaSyDvi5Arr_qEJv5UsocpIIrOBmxYcbCoN2E",
            authDomain: "flapping-bird-f9a21.firebaseapp.com",
            projectId: "flapping-bird-f9a21",
            storageBucket: "flapping-bird-f9a21.firebasestorage.app",
            messagingSenderId: "501160247273",
            appId: "1:501160247273:web:eec35ea17b64aa7dbbd578",
            measurementId: "G-SDPQVPP3TD"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const storage = getStorage(app);
        const analytics = getAnalytics(app);

        // Make Firebase services available globally
        window.firebaseServices = { db, auth, storage, addDoc, collection, updateDoc, doc, getDocs, setDoc, query, where, orderBy, limit, onSnapshot, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, storageRef, uploadBytes, getDownloadURL, deleteDoc };
    </script>

    <script>
        // Global variables
        let currentUser = null;
        let currentCampaignId = null;
        let campaigns = []; // Active campaigns for display
        let allCampaigns = []; // All campaigns including pending, completed etc.
        let campaignImages = []; // For campaign creation preview
        let userVerificationStatus = 'unverified'; // unverified, pending, verified

        // --- Helper Functions ---
        function formatDate(date) {
            if (!date) return 'Invalid Date';
            try {
                const d = date instanceof Date ? date : new Date(date);
                if (isNaN(d.getTime())) return 'Invalid Date';
                return d.toLocaleDateString('en-IN', { day: 'numeric', month: 'short', year: 'numeric' });
            } catch (error) {
                console.error('Date formatting error:', error);
                return 'Invalid Date';
            }
        }

        function showTab(tabId) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.querySelector(`[onclick="showTab('${tabId}')"]`).classList.add('active');
            document.getElementById(tabId).classList.add('active');
        }

        // URL routing for campaigns
        function updateURL(campaignId) {
            if (campaignId) {
                window.history.pushState({ campaignId }, '', `#campaign/${campaignId}`);
            } else {
                window.history.pushState({}, '', '#campaigns');
            }
        }

        function backToCampaigns() {
            updateURL(null);
            showHomePage();
            setTimeout(() => {
                document.getElementById('campaigns')?.scrollIntoView({ behavior: 'smooth' });
            }, 100);
        }

        // Handle browser back/forward buttons
        window.addEventListener('popstate', (event) => {
            if (event.state && event.state.campaignId) {
                viewCampaign(event.state.campaignId);
            } else {
                showHomePage();
            }
        });

        // Check URL on page load
        window.addEventListener('load', () => {
            const hash = window.location.hash;
            if (hash.startsWith('#campaign/')) {
                const campaignId = hash.replace('#campaign/', '');
                viewCampaign(campaignId);
            }
        });

        function getDefaultCategoryImage(category) {
            const images = {
                medical: 'https://images.unsplash.com/photo-1559757148-5c350d0d3c56?w=400&h=300&fit=crop',
                education: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=400&h=300&fit=crop',
                disaster: 'https://images.unsplash.com/photo-1547036967-23d11aacaee0?w=400&h=300&fit=crop',
                animal: 'https://images.unsplash.com/photo-1587300003388-59208cc962cb?w=400&h=300&fit=crop',
                debt: 'https://images.unsplash.com/photo-1605000797499-95a51c5269ae?w=400&h=300&fit=crop',
                social: 'https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=400&h=300&fit=crop'
            };
            return images[category] || images.medical;
        }

        // Generate dummy donors for sample campaigns (8-12 donors)
        function generateDummyDonors(campaign) {
            const seed = parseInt(campaign.id.split('_')[1] || '001');
            const raised = campaign.raised || campaign.raisedAmount || 0;
            
            const donorPool = [
                { name: 'Rajesh Kumar', messages: ['Praying for your recovery!', 'Stay strong!', 'May God bless you!'] },
                { name: 'Priya Singh', messages: ['Hope this helps.', 'Wishing you all the best', 'Get well soon!'] },
                { name: 'Amit Sharma', messages: ['Sending positive vibes!', 'Keep fighting!', 'You can do this!'] },
                { name: 'Sneha Iyer', messages: ['God is with you', 'Stay blessed', 'Prayers for your family'] },
                { name: 'Deepak Malhotra', messages: ['Wishing you strength', 'Never give up!', 'We are with you!'] },
                { name: 'Kavita Reddy', messages: ['Hope for the best!', 'Hang in there!', 'Sending love and support'] },
                { name: 'Rohan Desai', messages: ['You will overcome this', 'Stay positive!', 'God bless you'] },
                { name: 'Neha Kapoor', messages: ['Wishing you well', 'Keep your spirits up', 'May you recover soon'] },
                { name: 'Aditya Verma', messages: ['Support from our family', 'We believe in you', 'Prayers and blessings'] },
                { name: 'Pooja Nair', messages: ['Hope this makes a difference', 'Stay strong and brave', 'God will help you'] },
                { name: 'Sunil Joshi', messages: ['Wishing you speedy recovery', 'Keep the faith', 'You are in our prayers'] },
                { name: 'Divya Patel', messages: ['Sending healing thoughts', 'May God give you strength', 'We stand with you'] },
                { name: 'Vikram Rao', messages: ['Hope you get better soon', 'Stay hopeful', 'Prayers for your health'] },
                { name: 'Anjali Mishra', messages: ['Wishing you all the best', 'God bless your journey', 'Stay positive always'] },
                { name: 'Manish Tiwari', messages: ['Support for your cause', 'May you succeed', 'We are here for you'] },
                { name: 'Anonymous', messages: ['Best wishes', 'Hope this helps', 'Prayers for you', 'Stay blessed', 'God bless'] }
            ];

            // Shuffle donors based on campaign seed
            const shuffled = [...donorPool].sort((a, b) => {
                const hashA = (a.name.charCodeAt(0) + seed) % donorPool.length;
                const hashB = (b.name.charCodeAt(0) + seed) % donorPool.length;
                return hashA - hashB;
            });

            const donorCount = 8 + (seed % 5); // 8-12 donors
            const donors = [];
            
            // Calculate donation amounts that sum up to raised amount
            let remainingAmount = raised;
            for (let i = 0; i < donorCount && remainingAmount > 0; i++) {
                const donor = shuffled[i % shuffled.length];
                let amount;
                
                if (i === donorCount - 1) {
                    // Last donor gets remaining amount
                    amount = remainingAmount;
                } else {
                    // Random amount between 5-25% of remaining
                    const percentage = 0.05 + Math.random() * 0.20;
                    amount = Math.floor(remainingAmount * percentage);
                    amount = Math.max(500, Math.min(amount, remainingAmount - 500 * (donorCount - i - 1)));
                }
                
                const message = donor.messages[i % donor.messages.length];
                const daysAgo = Math.floor(Math.random() * 30) + 1;
                
                donors.push({
                    name: donor.name,
                    amount: amount,
                    message: message,
                    date: new Date(Date.now() - daysAgo * 24 * 60 * 60 * 1000)
                });
                
                remainingAmount -= amount;
            }

            return donors.sort((a, b) => b.date - a.date); // Sort by most recent first
        }

        // Generate Sample Payouts with varied amounts (up to 90% of raised)
        function generatePayouts(campaign) {
            const raised = campaign.raised || campaign.raisedAmount || 0;
            const seed = parseInt(campaign.id.split('_')[1] || '1');
            
            // Use 75-90% of raised amount for payouts
            const payoutPercentage = 0.75 + (seed % 16) * 0.01; // 75% to 90%
            const totalPayoutAmount = Math.floor(raised * payoutPercentage);
            const baseDate = campaign.created ? new Date(campaign.created) : new Date();

            if (totalPayoutAmount < 1000) return []; // Minimum for a payout

            const purposes = {
                medical: [
                    'First phase chemotherapy treatment and medicines',
                    'Surgery procedure and ICU charges',
                    'Post-operative care and medication',
                    'Blood tests and diagnostic reports',
                    'Hospital admission and consultation fees'
                ],
                education: [
                    'First semester tuition fees payment',
                    'Textbooks and study materials',
                    'Hostel and accommodation expenses',
                    'Laboratory fees and equipment',
                    'Library membership and reference books'
                ],
                disaster: [
                    'Emergency food and water distribution',
                    'Temporary shelter setup materials',
                    'Medical aid and first aid supplies',
                    'Rehabilitation and reconstruction work',
                    'Clothing and basic necessities'
                ],
                animal: [
                    'Emergency surgical procedure',
                    'Vaccination and deworming treatment',
                    'Shelter construction and bedding',
                    'Food supplies and nutrition supplements',
                    'Post-treatment care and medication'
                ],
                debt: [
                    'First installment to primary creditors',
                    'Clearing high-interest personal loans',
                    'Settlement of pending dues',
                    'Legal and documentation fees',
                    'Final debt clearance payment'
                ],
                social: [
                    'Initial construction and raw materials',
                    'Labor charges and equipment rental',
                    'Electrical and plumbing work',
                    'Finishing work and interior setup',
                    'Final installation and handover'
                ],
                students: [
                    'Course enrollment and semester fees',
                    'Books, stationery and study materials',
                    'Laptop and software licenses',
                    'Project work and lab expenses',
                    'Internship and placement preparation'
                ]
            };

            const categoryPurposes = purposes[campaign.category] || purposes.social;
            
            // Generate 2-4 payouts
            const numPayouts = 2 + (seed % 3);
            const payouts = [];
            let remainingAmount = totalPayoutAmount;
            
            for (let i = 0; i < numPayouts; i++) {
                let amount;
                if (i === numPayouts - 1) {
                    amount = remainingAmount; // Last payout gets remaining
                } else {
                    // Random percentage between 25-45% of remaining
                    const percentage = 0.25 + (seed % 20) * 0.01;
                    amount = Math.floor(remainingAmount * percentage);
                }
                
                if (amount >= 1000) {
                    const daysOffset = 8 + (i * 12) + (seed % 5);
                    payouts.push({
                        id: `${campaign.id}-payout${i + 1}`,
                        amount: amount,
                        date: new Date(baseDate.getTime() + (daysOffset * 24 * 60 * 60 * 1000)),
                        purpose: categoryPurposes[i % categoryPurposes.length],
                        campaignId: campaign.id
                    });
                    remainingAmount -= amount;
                }
            }

            return payouts;
        }

        // Generate realistic campaign updates based on category
        function generateUpdates(campaign) {
            const seed = parseInt(campaign.id.split('_')[1] || '1');
            const baseDate = campaign.created ? new Date(campaign.created) : new Date();
            const organizerName = campaign.organizer.name.split(' ')[0];

            const updateTemplates = {
                medical: [
                    {
                        title: 'First treatment session completed successfully',
                        text: `${organizerName} here. Just wanted to update all the wonderful donors - the first treatment session went well today. The doctors are optimistic about the progress. Your support means everything to our family during this difficult time. Will keep you posted on the next steps.`,
                        days: 5
                    },
                    {
                        title: 'Doctor\'s positive update on recovery',
                        text: `Great news everyone! The doctors said the treatment is showing positive results. Medical reports have improved and we're scheduled for the next phase. Cannot thank you all enough for making this possible. Prayers and blessings to all donors.`,
                        days: 15
                    },
                    {
                        title: 'Continuing treatment with your support',
                        text: `Update: The treatment is progressing well. We have completed the critical phase and the response has been encouraging. Every donation has directly contributed to life-saving care. Deeply grateful for your kindness and generosity.`,
                        days: 28
                    }
                ],
                education: [
                    {
                        title: 'Classes have started!',
                        text: `Hello everyone! ${organizerName} here. I'm so grateful to share that I've started attending my classes. The first week has been overwhelming but exciting. Bought all the required textbooks and course materials with your generous donations. Thank you for believing in my dreams!`,
                        days: 6
                    },
                    {
                        title: 'Mid-semester progress update',
                        text: `Update from ${organizerName} - completing my first month of college! The professors are excellent and I'm learning so much. Your support has not only helped me pay fees but also given me the confidence to pursue my goals. Will make you all proud!`,
                        days: 18
                    },
                    {
                        title: 'Excelling in academics',
                        text: `Wonderful news! Just received my first semester results and I've scored distinction in all subjects. This wouldn't have been possible without your support. Working harder every day to justify your faith in me. Thank you from the bottom of my heart!`,
                        days: 32
                    }
                ],
                students: [
                    {
                        title: 'All study materials purchased',
                        text: `Hi supporters! Just bought all my textbooks, lab equipment, and course materials. Everything I needed for this semester is now ready. Starting my classes with full preparation thanks to your kindness. Feeling blessed and motivated!`,
                        days: 4
                    },
                    {
                        title: 'Mid-semester exam results',
                        text: `${organizerName} here with an update! Completed my mid-term exams and doing well in all subjects. The study materials you helped me get are being put to great use. Working hard to achieve good grades and make the most of this opportunity.`,
                        days: 16
                    },
                    {
                        title: 'Project work in progress',
                        text: `Great progress on my semester project! Your support helped me get the equipment and resources needed. Presenting my work next week and feeling confident. Thank you for investing in my education and future!`,
                        days: 25
                    }
                ],
                disaster: [
                    {
                        title: 'Immediate relief distributed',
                        text: `Team update - We've successfully distributed emergency supplies to 200+ affected families. Food packets, clean water, and basic medicines have reached those who need it most. Your quick response is saving lives. Thank you!`,
                        days: 2
                    },
                    {
                        title: 'Temporary shelters set up',
                        text: `Positive update! With your support, temporary shelters are now providing safety to 150+ families. Community kitchen is feeding 300+ people daily. The relief work continues. Every rupee is making a real difference.`,
                        days: 12
                    },
                    {
                        title: 'Rehabilitation work underway',
                        text: `Rebuilding has begun! Families are receiving construction materials to rebuild their homes. Essential services are being restored. Your generosity is helping an entire community get back on their feet. Deeply grateful!`,
                        days: 25
                    }
                ],
                animal: [
                    {
                        title: 'Surgery completed successfully!',
                        text: `Wonderful news from the vet! The surgery went perfectly and our friend is now recovering well. Still under observation but showing excellent signs. Thank you all for helping save this precious life. Will share recovery photos soon!`,
                        days: 3
                    },
                    {
                        title: 'Amazing recovery progress',
                        text: `Great progress! The wounds are healing beautifully and appetite is back to normal. Started physiotherapy sessions this week. The vet says recovery is ahead of schedule thanks to the timely treatment your donations made possible. Grateful beyond words!`,
                        days: 11
                    },
                    {
                        title: 'Fully recovered and thriving',
                        text: `Incredible news! Our furry friend has made a complete recovery and is now healthy and active. All thanks to your kindness and generosity. This life was saved because of your compassion. Forever thankful!`,
                        days: 22
                    }
                ],
                debt: [
                    {
                        title: 'First major payment completed',
                        text: `${organizerName} here with hopeful news. Made the first significant payment to clear our high-interest loans. The pressure has reduced considerably. Your support is helping us get back on our feet and restart our livelihood. Thank you for giving us hope!`,
                        days: 7
                    },
                    {
                        title: 'Debt burden reducing significantly',
                        text: `Update - We've cleared 65% of the debt! The relief is immense. Can finally sleep peacefully after months of stress. Working hard to ensure we never fall into this situation again. Your kindness has given our family a second chance at life.`,
                        days: 20
                    },
                    {
                        title: 'Almost debt-free!',
                        text: `Amazing progress! We've cleared 85% of our debt and can see the light at the end of the tunnel. Your support has transformed our lives. We're rebuilding with dignity and hope. Cannot thank you enough for believing in us!`,
                        days: 35
                    }
                ],
                social: [
                    {
                        title: 'Project work has begun',
                        text: `Exciting update! Construction work has begun and the foundation is being laid. The community is actively participating and the energy is amazing. Your donations are being used exactly as promised. Will share photos of the progress soon!`,
                        days: 8
                    },
                    {
                        title: 'Major milestone achieved',
                        text: `Great progress update! We're now 60% done with the project. The structure is taking shape beautifully and the community is thrilled. Every contribution has been utilized responsibly. Thank you for making this dream come true!`,
                        days: 22
                    },
                    {
                        title: 'Nearing completion',
                        text: `Final update - The project is 90% complete! Final touches are being added and it looks amazing. This community project will benefit hundreds of families for years to come. Your generosity has created lasting change!`,
                        days: 38
                    }
                ]
            };

            const categoryUpdates = updateTemplates[campaign.category] || updateTemplates.social;
            
            // Generate 2-3 updates based on campaign seed
            const numUpdates = 2 + (seed % 2);
            return categoryUpdates.slice(0, numUpdates).map((template, index) => ({
                id: `${campaign.id}-update${index + 1}`,
                title: template.title,
                text: template.text,
                date: new Date(baseDate.getTime() + (template.days * 24 * 60 * 60 * 1000)),
                campaignId: campaign.id
            }));
        }


        // --- Firebase Functions ---
        async function loadDataFromStorage() {
            try {
                const { getDocs, collection, onSnapshot } = window.firebaseServices;
                const db = window.firebaseServices.db;

                // Set up real-time listener for campaigns
                const campaignsRef = collection(db, 'campaigns');
                onSnapshot(campaignsRef,
                    (snapshot) => {
                        if (snapshot && !snapshot.empty) {
                            const firebaseCampaigns = snapshot.docs.map(doc => {
                                const data = doc.data();
                                return {
                                    id: doc.id,
                                    ...data,
                                    created: data.created?.toDate?.() || (data.created instanceof Date ? data.created : new Date(data.created || Date.now())),
                                    updatedAt: data.updatedAt?.toDate?.() || (data.updatedAt instanceof Date ? data.updatedAt : new Date())
                                };
                            });

                            allCampaigns = firebaseCampaigns;
                            campaigns = allCampaigns.filter(c => c.status === 'active');

                            renderCampaigns(); // Re-render carousel
                            if (currentUser && currentUser.isAdmin) {
                                renderAdminPanel();
                            }

                            console.log('✅ Campaigns synced from Firebase:', allCampaigns.length);
                        } else {
                            allCampaigns = [];
                            campaigns = [];
                            renderCampaigns();
                            console.log('Firebase is empty - no campaigns');
                        }
                    },
                    (error) => {
                        console.error('❌ Firebase sync error:', error);
                        showNotification('Connection issue. Retrying...', 'warning');
                    }
                );

                const storedUser = localStorage.getItem('currentUser');
                if (storedUser) {
                    currentUser = JSON.parse(storedUser);
                    updateAuthUI();
                }

                const storedVerification = localStorage.getItem('userVerificationStatus');
                if (storedVerification) {
                    userVerificationStatus = storedVerification;
                }
            } catch (error) {
                console.error('Error loading data from Firestore:', error);
                showNotification('Failed to connect to database. Please refresh.', 'error');
            }
        }

        async function saveCampaignToFirestore(campaign) {
            try {
                const { addDoc, collection, doc, setDoc } = window.firebaseServices;
                const db = window.firebaseServices.db;

                if (campaign.id && campaign.id.startsWith('camp_')) {
                    // Update existing campaign
                    await setDoc(doc(db, 'campaigns', campaign.id), {
                        ...campaign,
                        created: campaign.created || new Date(),
                        updatedAt: new Date()
                    });
                } else {
                    // Create new campaign
                    const docRef = await addDoc(collection(db, 'campaigns'), {
                        ...campaign,
                        created: new Date(),
                        updatedAt: new Date()
                    });
                    campaign.id = docRef.id;
                }
                return campaign.id;
            } catch (error) {
                console.error('Error saving campaign to Firestore:', error);
                throw error;
            }
        }

        async function deleteCampaignFromFirestore(campaignId) {
            try {
                const { deleteDoc, doc } = window.firebaseServices;
                const db = window.firebaseServices.db;

                await deleteDoc(doc(db, 'campaigns', campaignId));
            } catch (error) {
                console.error('Error deleting campaign from Firestore:', error);
                throw error;
            }
        }

        // --- Campaign Rendering & Management ---
        function renderCampaigns(filter = 'all') {
            const carousel = document.getElementById('campaignsCarousel');
            if (!carousel) return;

            let filteredCampaigns = campaigns.filter(c => c.status === 'active');

            if (filter !== 'all') {
                filteredCampaigns = filteredCampaigns.filter(c => c.category === filter);
            }

            carousel.innerHTML = ''; // Clear existing items

            if (filteredCampaigns.length === 0) {
                carousel.innerHTML = `
                    <div class="empty-state" style="min-width: 100%;">
                        <i class="fas fa-search"></i>
                        <h3>No Campaigns Found</h3>
                        <p>Try adjusting your filters or check back later.</p>
                    </div>
                `;
                return;
            }

            filteredCampaigns.forEach(campaign => {
                const carouselItem = document.createElement('div');
                carouselItem.className = 'carousel-item';

                const raised = campaign.raised || campaign.raisedAmount || 0;
                const goal = campaign.goal || campaign.goalAmount;
                const progressPercentage = Math.min((raised / goal) * 100, 100);
                const canDelete = currentUser && (
                    currentUser.isAdmin ||
                    (campaign.organizer && campaign.organizer.uid === currentUser.uid)
                );

                // Get the correct image - prioritize imageUrl, then images array, then image field, then default
                const campaignImage = campaign.imageUrl || (campaign.images && campaign.images[0]) || campaign.image || getDefaultCategoryImage(campaign.category);

                const card = document.createElement('div');
                card.className = 'campaign-card';
                card.dataset.category = campaign.category;
                card.innerHTML = `
                    <div class="campaign-image-container">
                        <img src="${campaignImage}" alt="${campaign.title}" class="campaign-image">
                        <div class="campaign-badge ${campaign.urgent ? 'urgent-badge' : ''}">${campaign.urgent ? 'URGENT' : campaign.status.toUpperCase()}</div>
                        ${campaign.verified ? '<div class="campaign-badge" style="background: #28a745; left: auto; right: 15px;">VERIFIED</div>' : ''}
                    </div>
                    <div class="campaign-content">
                        <h3 class="campaign-title">${campaign.title}</h3>
                        <p class="campaign-organizer">by ${campaign.organizer.name} • ${campaign.location}</p>
                        <p class="campaign-description">${campaign.description}</p>
                        <div class="campaign-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progressPercentage}%"></div>
                            </div>
                            <div class="progress-info">
                                <span class="amount-raised">₹${raised.toLocaleString()}</span>
                                <span>₹${goal.toLocaleString()}</span>
                            </div>
                            <div class="progress-info">
                                <span>${campaign.donors || 0} donors</span>
                                <span>${campaign.daysLeft === 999 ? 'Ongoing' : campaign.daysLeft + ' days left'}</span>
                            </div>
                        </div>

                        <div class="campaign-footer">
                            <div class="campaign-actions">
                                <button class="btn btn-primary btn-small" onclick="viewCampaign('${campaign.id}'); updateURL('${campaign.id}');">
                                    <i class="fas fa-eye"></i> View Details
                                </button>
                                <button class="btn btn-outline btn-small" onclick="openDonationModal('${campaign.id}')">
                                    <i class="fas fa-heart"></i> Donate
                                </button>
                            </div>
                            ${canDelete ? `
                                <div class="admin-actions">
                                    <button class="btn btn-outline btn-small" onclick="editCampaignAsAdmin('${campaign.id}')" title="Edit Campaign">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="delete-btn" onclick="deleteCampaign('${campaign.id}')" title="Delete Campaign">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;

                carouselItem.appendChild(card);
                carousel.appendChild(carouselItem);
            });

            // Add navigation buttons after rendering items
            addCarouselNavigation(carousel);
        }

        function addCarouselNavigation(carouselElement) {
            // Remove existing navigation if any
            carouselElement.parentElement.querySelectorAll('.carousel-nav').forEach(nav => nav.remove());

            // Only add navigation if there are multiple items
            if (carouselElement.children.length > 1) {
                const prevButton = document.createElement('button');
                prevButton.className = 'carousel-nav prev';
                prevButton.innerHTML = '<i class="fas fa-chevron-left"></i>';
                prevButton.onclick = () => scrollCarousel(carouselElement, -carouselElement.offsetWidth);

                const nextButton = document.createElement('button');
                nextButton.className = 'carousel-nav next';
                nextButton.innerHTML = '<i class="fas fa-chevron-right"></i>';
                nextButton.onclick = () => scrollCarousel(carouselElement, carouselElement.offsetWidth);

                carouselElement.parentElement.appendChild(prevButton);
                carouselElement.parentElement.appendChild(nextButton);
            }
        }

        function scrollCarousel(carouselElement, scrollAmount) {
            const itemWidth = carouselElement.querySelector('.carousel-item')?.offsetWidth || 300;
            const scrollDistance = window.innerWidth < 768 ? carouselElement.offsetWidth * 0.9 : itemWidth + 30;
            carouselElement.scrollBy({
                left: scrollAmount > 0 ? scrollDistance : -scrollDistance,
                behavior: 'smooth'
            });
        }

        function viewCampaign(campaignId) {
            const campaign = allCampaigns.find(c => c.id === campaignId);
            if (!campaign) {
                showNotification('Campaign not found', 'error');
                return;
            }

            currentCampaignId = campaignId;
            updateURL(campaignId);

            // Hide home page, show campaign detail
            document.getElementById('homePage').style.display = 'none';
            document.getElementById('campaignDetail').classList.add('active');

            // Populate campaign details
            document.getElementById('detailCampaignTitle').textContent = campaign.title;
            document.getElementById('detailCampaignOrganizer').textContent = campaign.organizer.name;
            document.getElementById('detailCampaignLocation').textContent = campaign.location;
            document.getElementById('detailCampaignDate').textContent = formatDate(campaign.created);
            document.getElementById('detailCampaignStory').textContent = ''; // Remove from header
            document.getElementById('detailCampaignStoryFull').textContent = campaign.description;

            // Progress bar
            const raised = campaign.raised || campaign.raisedAmount || 0;
            const goal = campaign.goal || campaign.goalAmount;
            const progressPercentage = Math.min((raised / goal) * 100, 100);
            document.getElementById('detailProgressFill').style.width = progressPercentage + '%';
            document.getElementById('detailAmountRaised').textContent = '₹' + raised.toLocaleString();
            document.getElementById('detailGoalAmount').textContent = '₹' + goal.toLocaleString();
            document.getElementById('detailDonorCount').textContent = (campaign.donors || 0) + ' donors';
            document.getElementById('detailDaysLeft').textContent = campaign.daysLeft === 999 ? 'Ongoing' : campaign.daysLeft + ' days left';

            // Campaign badge
            document.getElementById('detailCampaignBadge').textContent = campaign.urgent ? 'URGENT' : campaign.status.toUpperCase();
            document.getElementById('detailCampaignBadge').className = 'campaign-badge' + (campaign.urgent ? ' urgent-badge' : '');

            // Load images carousel
            const imagesCarousel = document.getElementById('campaignImagesCarousel');
            imagesCarousel.innerHTML = '';
            const images = campaign.imageUrls || [campaign.image || campaign.imageUrl || getDefaultCategoryImage(campaign.category)];
            images.forEach(img => {
                const imgDiv = document.createElement('div');
                imgDiv.style.cssText = 'min-width: 100%; height: 100%; scroll-snap-align: start;';
                imgDiv.innerHTML = `<img src="${img}" style="width: 100%; height: 100%; object-fit: cover;">`;
                imagesCarousel.appendChild(imgDiv);
            });

            // Load payouts, updates, and donors
            loadCampaignPayouts(campaign);
            loadCampaignUpdates(campaign);
            loadCampaignDonors(campaign);

            // Scroll to top
            window.scrollTo(0, 0);
        }

        function loadCampaignPayouts(campaign) {
            const payouts = generatePayouts(campaign);
            document.getElementById('payoutCount').textContent = payouts.length;
            const payoutsList = document.getElementById('payoutsList');
            
            if (payouts.length === 0) {
                payoutsList.innerHTML = '<div class="empty-state"><i class="fas fa-wallet"></i><h3>No Payouts Yet</h3><p>Payouts will appear here once funds are withdrawn.</p></div>';
            } else {
                payoutsList.innerHTML = payouts.map(payout => `
                    <div class="payout-item">
                        <div class="payout-header">
                            <span class="payout-amount">₹${payout.amount.toLocaleString()}</span>
                            <span class="payout-date">${formatDate(payout.date)}</span>
                        </div>
                        <p class="payout-purpose">${payout.purpose}</p>
                    </div>
                `).join('');
            }
        }

        function loadCampaignUpdates(campaign) {
            const updates = generateUpdates(campaign);
            document.getElementById('updateCount').textContent = updates.length;
            const updatesList = document.getElementById('updatesList');
            
            if (updates.length === 0) {
                updatesList.innerHTML = '<div class="empty-state"><i class="fas fa-bullhorn"></i><h3>No Updates Yet</h3><p>Campaign updates will appear here.</p></div>';
            } else {
                updatesList.innerHTML = updates.map(update => `
                    <div class="update-item">
                        <div class="update-header">
                            <span class="update-title">${update.title}</span>
                            <span class="update-date">${formatDate(update.date)}</span>
                        </div>
                        <p class="update-text">${update.text}</p>
                    </div>
                `).join('');
            }
        }

        function loadCampaignDonors(campaign) {
            const donors = campaign.donorsList || generateDummyDonors(campaign);
            const donorsList = document.getElementById('donorsList');
            
            if (donors.length === 0) {
                donorsList.innerHTML = '<div class="empty-state"><i class="fas fa-users"></i><h3>No Donations Yet</h3><p>Be the first to support this campaign!</p></div>';
            } else {
                donorsList.innerHTML = donors.map(donor => `
                    <div class="donor-item">
                        <div class="donor-info">
                            <h4>${donor.name}</h4>
                            <p style="color: var(--gray); font-size: 0.9rem;">${donor.message}</p>
                            <p style="color: var(--gray); font-size: 0.85rem;">${formatDate(donor.date)}</p>
                        </div>
                        <div class="donor-amount">₹${donor.amount.toLocaleString()}</div>
                    </div>
                `).join('');
            }
        }

        async function initializeSampleCampaigns() {
            await loadDataFromStorage();

            if (allCampaigns.length === 0) {
                console.log('Firestore is empty. Initializing campaigns...');

                const campaignsData = [
                    {
                        id: 'camp_001',
                        title: 'Please Help Save My 4-Year-Old Son Aarav from Leukemia',
                        description: 'I am Ramesh Kumar from Nagpur. My world came crashing down when doctors diagnosed my 4-year-old son Aarav with Acute Lymphoblastic Leukemia. I work as a daily wage laborer, and my wife Priya helps at a local shop. We have spent everything we had - our savings, sold jewelry, also borrowed from relatives - but it\'s still not enough. Aarav needs immediate chemotherapy at Tata Memorial Hospital costing ₹15 lakhs. Doctors say he can fully recover with treatment. My little boy loves his red toy car and dreams of becoming a pilot someday. I cannot let him lose this battle. Please help me save my son. Every rupee you donate gives Aarav a chance to live. I am begging you with folded hands - please help us.',
                        goal: 1500000,
                        raised: 990000,
                        organizer: { name: 'Ramesh Kumar (Father)', uid: 'user_001' },
                        category: 'medical',
                        location: 'Nagpur, Maharashtra',
                        status: 'active',
                        urgent: true,
                        imageUrl: 'https://images.unsplash.com/photo-1559757148-5c350d0d3c56?w=400&h=300&fit=crop',
                        imageUrls: [
                            'https://images.unsplash.com/photo-1559757148-5c350d0d3c56?w=400&h=300&fit=crop',
                            'https://images.unsplash.com/photo-1576091160399-112ba8d25d1f?w=400&h=300&fit=crop',
                            'https://images.unsplash.com/photo-1579684385127-1ef15d508118?w=400&h=300&fit=crop'
                        ],
                        donors: 287,
                        daysLeft: 23,
                        duration: '60',
                        created: new Date('2025-09-25'),
                        isSampleCampaign: true,
                        verified: true,
                        donorsList: [
                            { name: 'Priya Singh', amount: 10000, message: 'Get well soon, little one!', date: new Date('2025-09-24') },
                            { name: 'Rohan Mehta', amount: 5000, message: 'Praying for Aarav\'s speedy recovery.', date: new Date('2025-09-23') },
                            { name: 'Anonymous', amount: 2000, message: 'Hope this helps.', date: new Date('2025-09-22') }
                        ]
                    },
                    {
                        id: 'camp_002',
                        title: 'Please Help Me Continue My Education - I Scored 96% But Can\'t Afford College',
                        description: 'Namaste, I am Meera Sharma from a small village in Rajasthan. I scored 96% in my 12th boards and got admission to study medicine. I want to become a doctor and serve my village where we don\'t have proper medical facilities. But my father is a farmer and we lost our entire crop to drought this year. He has no money for my college fees. My admission will be cancelled if I can\'t pay ₹5 lakhs for the first year. I have worked so hard for this dream. Please don\'t let poverty kill my ambition. I promise to serve rural areas and help people like my family. Your support can change my life and help me serve thousands of patients in the future. Please help me study.',
                        goal: 500000,
                        raised: 320000,
                        organizer: { name: 'Meera Sharma', uid: 'user_002' },
                        category: 'education',
                        location: 'Jodhpur, Rajasthan',
                        status: 'active',
                        urgent: false,
                        imageUrl: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=400&h=300&fit=crop',
                        imageUrls: ['https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=400&h=300&fit=crop', 'https://images.unsplash.com/photo-1523240795612-9a054b0db644?w=400&h=300&fit=crop'],
                        donors: 156,
                        daysLeft: 45,
                        duration: '90',
                        created: new Date('2025-08-28'),
                        isSampleCampaign: true,
                        verified: true,
                        donorsList: [
                            { name: 'Anil Kumar', amount: 5000, message: 'Education is the key!', date: new Date('2025-09-20') },
                            { name: 'Sunita Devi', amount: 3000, message: 'Best wishes for your studies', date: new Date('2025-09-19') }
                        ]
                    },
                    {
                        id: 'camp_003',
                        title: 'We Lost Everything in Kerala Floods - Please Help Us Rebuild Our Homes',
                        description: 'I am writing this from a relief camp in Kochi. The floods took everything from us - our homes, belongings, documents, everything we worked for our entire lives. I used to run a small shop, but it\'s completely destroyed. My family and thousands of others are living in temporary shelters with nothing. We need urgent help for food, clean water, medicines, and to start rebuilding our homes. My children are traumatized and we have nowhere to go. The government relief is not enough. Please help us get back on our feet. We want to rebuild our lives with dignity. Any amount you can donate will help us survive and start again. We will never forget your kindness.',
                        goal: 2000000,
                        raised: 1450000,
                        organizer: { name: 'Kerala Relief Foundation', uid: 'user_003' },
                        category: 'disaster',
                        location: 'Kochi, Kerala',
                        status: 'active',
                        urgent: true,
                        imageUrl: 'https://images.unsplash.com/photo-1547036967-23d11aacaee0?w=400&h=300&fit=crop',
                        imageUrls: ['https://images.unsplash.com/photo-1547036967-23d11aacaee0?w=400&h=300&fit=crop'],
                        donors: 890,
                        daysLeft: 12,
                        duration: '30',
                        created: new Date('2025-10-01'),
                        isSampleCampaign: true,
                        verified: true,
                        donorsList: [
                            { name: 'Rajesh Pillai', amount: 15000, message: 'Help is on the way!', date: new Date('2025-10-01') },
                            { name: 'Shalini Nair', amount: 10000, message: 'Wishing the best for rebuilding.', date: new Date('2025-09-30') },
                            { name: 'Anonymous', amount: 5000, message: 'Stay strong Kerala!', date: new Date('2025-09-30') }
                        ]
                    },
                    {
                        id: 'camp_004',
                        title: 'Save Tommy - Injured Street Dog Needs Surgery',
                        description: 'Tommy, a friendly street dog, was hit by a vehicle and has severe injuries to his hind legs. The local animal shelter is struggling to cover his surgery costs of ₹75,000. Tommy is in pain but still wags his tail when he sees people. Help us give Tommy a second chance at life.',
                        goal: 75000,
                        raised: 48000,
                        organizer: { name: 'Paws & Hearts Animal Shelter', uid: 'user_004' },
                        category: 'animal',
                        location: 'Pune, Maharashtra',
                        status: 'active',
                        urgent: true,
                        imageUrl: 'https://images.unsplash.com/photo-1587300003388-59208cc962cb?w=400&h=300&fit=crop',
                        imageUrls: ['https://images.unsplash.com/photo-1587300003388-59208cc962cb?w=400&h=300&fit=crop'],
                        donors: 95,
                        daysLeft: 8,
                        duration: '30',
                        created: new Date('2025-09-28'),
                        isSampleCampaign: true,
                        verified: true,
                        donorsList: [
                            { name: 'Animal Lover', amount: 2000, message: 'Hope Tommy gets well soon!', date: new Date('2025-09-27') },
                            { name: 'Pooja Desai', amount: 1500, message: 'For Tommy\'s treatment.', date: new Date('2025-09-26') }
                        ]
                    },
                    {
                        id: 'camp_005',
                        title: 'Help Ravi Clear Agricultural Debt & Save His Farm',
                        description: 'Ravi, a small farmer from Andhra Pradesh, is drowning in debt after consecutive crop failures due to unpredictable weather. He owes ₹3 lakhs to moneylenders charging high interest. Without help, he might lose his ancestral land. Your support can help him clear debt and restart farming.',
                        goal: 300000,
                        raised: 125000,
                        organizer: { name: 'Ravi Reddy', uid: 'user_005' },
                        category: 'debt',
                        location: 'Guntur, Andhra Pradesh',
                        status: 'active',
                        urgent: false,
                        imageUrl: 'https://images.unsplash.com/photo-1605000797499-95a51c5269ae?w=400&h=300&fit=crop',
                        imageUrls: ['https://images.unsplash.com/photo-1605000797499-95a51c5269ae?w=400&h=300&fit=crop'],
                        donors: 67,
                        daysLeft: 67,
                        duration: 'ongoing',
                        created: new Date('2025-09-18'),
                        isSampleCampaign: true,
                        verified: true,
                        donorsList: [
                            { name: 'Farmer Support Group', amount: 10000, message: 'May your farm prosper!', date: new Date('2025-09-25') },
                            { name: 'Anonymous', amount: 5000, message: 'For financial relief.', date: new Date('2025-09-24') }
                        ]
                    },
                    {
                        id: 'camp_006',
                        title: 'Clean Water Project for Tribal Village',
                        description: 'A remote tribal village in Odisha has been without clean drinking water for years. Villagers, mostly women and children, walk 5km daily to fetch water. We\'re building a borewell and water purification system to provide clean water to 200+ families. Your donation brings hope.',
                        goal: 800000,
                        raised: 580000,
                        organizer: { name: 'Tribal Welfare Society', uid: 'user_006' },
                        category: 'social',
                        location: 'Rayagada, Odisha',
                        status: 'active',
                        urgent: false,
                        imageUrl: 'https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=400&h=300&fit=crop',
                        imageUrls: ['https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=400&h=300&fit=crop'],
                        donors: 234,
                        daysLeft: 28,
                        duration: '60',
                        created: new Date('2025-09-10'),
                        isSampleCampaign: true,
                        verified: true,
                        donorsList: [
                            { name: 'Water For All', amount: 25000, message: 'Clean water for everyone!', date: new Date('2025-09-15') },
                            { name: 'Community Upliftment Fund', amount: 20000, message: 'Supporting basic needs.', date: new Date('2025-09-14') }
                        ]
                    },
                    {
                        id: 'camp_007',
                        title: 'Fund MBA Dreams for Talented Village Girl',
                        description: 'Kavita, from a small village in UP, cracked CAT exam and got admission to a top B-school. Her parents are farmers who cannot afford the ₹15 lakh annual fees. She wants to become an entrepreneur and uplift her village.',
                        goal: 1500000,
                        raised: 420000,
                        organizer: { name: 'Kavita Singh', uid: 'user_013' },
                        category: 'education',
                        location: 'Lucknow, Uttar Pradesh',
                        status: 'active',
                        urgent: false,
                        imageUrl: 'https://images.unsplash.com/photo-1523240795612-9a054b0db644?w=400&h=300&fit=crop',
                        donors: 156,
                        daysLeft: 35,
                        duration: '60',
                        created: new Date('2025-09-14'),
                        isSampleCampaign: true,
                        verified: true,
                        donorsList: [
                            { name: 'Future Innovators', amount: 5000, message: 'Dream big, Ananya!', date: new Date('2025-09-12') },
                            { name: 'Anonymous', amount: 3000, message: 'Support your education.', date: new Date('2025-09-11') }
                        ]
                    },
                    {
                        id: 'camp_008',
                        title: 'Kidney Transplant for Single Father',
                        description: 'Suresh, a 42-year-old single father of two daughters, is suffering from kidney failure. He needs an urgent transplant costing ₹12 lakhs. He has been on dialysis for 2 years and his health is deteriorating rapidly.',
                        goal: 1200000,
                        raised: 550000,
                        organizer: { name: 'Suresh\'s Daughters', uid: 'user_014' },
                        category: 'medical',
                        location: 'Chennai, Tamil Nadu',
                        status: 'active',
                        urgent: true,
                        imageUrl: 'https://images.unsplash.com/photo-1579684385127-1ef15d508118?w=400&h=300&fit=crop',
                        donors: 198,
                        daysLeft: 18,
                        duration: '45',
                        created: new Date('2025-09-24'),
                        isSampleCampaign: true,
                        verified: true,
                        donorsList: [
                            { name: 'Hope Foundation', amount: 20000, message: 'Wishing Suresh a full recovery.', date: new Date('2025-09-23') },
                            { name: 'Anonymous', amount: 15000, message: 'May he get well soon.', date: new Date('2025-09-22') }
                        ]
                    },
                    {
                        id: 'camp_009',
                        title: 'Build Library for Tribal School Children',
                        description: 'A remote tribal school in Jharkhand with 200 students has no library. We want to build a small library with 500+ books, reading space, and basic furniture. Education is the only way these children can break the cycle of poverty.',
                        goal: 250000,
                        raised: 120000,
                        organizer: { name: 'Tribal Education Foundation', uid: 'user_009' },
                        category: 'social',
                        location: 'Ranchi, Jharkhand',
                        status: 'active',
                        urgent: false,
                        imageUrl: 'https://images.unsplash.com/photo-1456513080510-0b793f4b4173?w=400&h=300&fit=crop',
                        donors: 78,
                        daysLeft: 40,
                        duration: '60',
                        created: new Date('2025-09-12'),
                        isSampleCampaign: true,
                        verified: true,
                        donorsList: [
                            { name: 'Readers United', amount: 7000, message: 'Books for knowledge!', date: new Date('2025-09-10') },
                            { name: 'Literacy India', amount: 5000, message: 'Empowering through education.', date: new Date('2025-09-09') }
                        ]
                    },
                    {
                        id: 'camp_010',
                        title: 'Assam Flood Relief - Emergency Food & Shelter',
                        description: 'Severe floods in Assam have displaced 5,000+ families. We need immediate funds for food packets, clean drinking water, temporary shelter, and basic medicines. Your donation will directly help affected families.',
                        goal: 1500000,
                        raised: 680000,
                        organizer: { name: 'Assam Relief Volunteers', uid: 'user_012' },
                        category: 'disaster',
                        location: 'Guwahati, Assam',
                        status: 'active',
                        urgent: true,
                        imageUrl: 'https://images.unsplash.com/photo-1559827260-dc66d52bef19?w=400&h=300&fit=crop',
                        donors: 342,
                        daysLeft: 20,
                        duration: '30',
                        created: new Date('2025-09-17'),
                        isSampleCampaign: true,
                        verified: true,
                        donorsList: [
                            { name: 'Assam Aid', amount: 12000, message: 'Help for flood victims.', date: new Date('2025-09-16') },
                            { name: 'Anonymous', amount: 10000, message: 'Sending support to Assam.', date: new Date('2025-09-15') }
                        ]
                    },
                    {
                        id: 'camp_011',
                        title: 'Help Widow Clear Business Loan Debt',
                        description: 'Lakshmi, a 45-year-old widow, took a loan to start a small tailoring business. After her husband\'s death, she couldn\'t repay and lenders are threatening to seize her sewing machines. She needs ₹2 lakhs to clear debt and restart her business.',
                        goal: 200000,
                        raised: 85000,
                        organizer: { name: 'Lakshmi Devi', uid: 'user_011' },
                        category: 'debt',
                        location: 'Hyderabad, Telangana',
                        status: 'active',
                        urgent: false,
                        imageUrl: 'https://images.unsplash.com/photo-155638158-158ea5ccacbd?w=400&h=300&fit=crop',
                        donors: 52,
                        daysLeft: 55,
                        duration: 'ongoing',
                        created: new Date('2025-09-08'),
                        isSampleCampaign: true,
                        verified: true,
                        donorsList: [
                            { name: 'Empower Her', amount: 5000, message: 'For financial independence.', date: new Date('2025-09-07') },
                            { name: 'Anonymous', amount: 3000, message: 'Help Lakshmi restart.', date: new Date('2025-09-06') }
                        ]
                    },
                    {
                        id: 'camp_012',
                        title: 'Save Abandoned Puppies - Vaccination & Shelter',
                        description: '12 abandoned puppies found on the highway need urgent vaccination, deworming, and temporary shelter. Without help, they won\'t survive the harsh weather. Each puppy needs ₹4,000 for complete medical care.',
                        goal: 50000,
                        raised: 32000,
                        organizer: { name: 'Street Dogs Rescue', uid: 'user_010' },
                        category: 'animal',
                        location: 'Bangalore, Karnataka',
                        status: 'active',
                        urgent: true,
                        imageUrl: 'https://images.unsplash.com/photo-1548199973-03cce0bbc87b?w=400&h=300&fit=crop',
                        donors: 68,
                        daysLeft: 10,
                        duration: '30',
                        created: new Date('2025-09-30'),
                        isSampleCampaign: true,
                        verified: true,
                        donorsList: [
                            { name: 'Animal Angels', amount: 1000, message: 'For the puppies!', date: new Date('2025-09-29') },
                            { name: 'Anonymous', amount: 500, message: 'Help these little ones.', date: new Date('2025-09-28') }
                        ]
                    },
                    {
                        id: 'camp_013',
                        title: 'Support Ananya\'s Computer Science Degree',
                        description: 'Ananya scored 98% in her 12th boards and got admission to IIT Bombay for Computer Science. Her father is a small shopkeeper who cannot afford the ₹4 lakh annual fees. She wants to become an entrepreneur and uplift her village.',
                        goal: 400000,
                        raised: 180000,
                        organizer: { name: 'Ananya Patel', uid: 'user_007' },
                        category: 'education',
                        location: 'Mumbai, Maharashtra',
                        status: 'active',
                        urgent: false,
                        imageUrl: 'https://images.unsplash.com/photo-1523240795612-9a054b0db644?w=400&h=300&fit=crop',
                        donors: 89,
                        daysLeft: 50,
                        duration: '90',
                        created: new Date('2025-09-05'),
                        isSampleCampaign: true,
                        verified: true,
                        donorsList: [
                            { name: 'Future Innovators', amount: 5000, message: 'Dream big, Ananya!', date: new Date('2025-09-04') },
                            { name: 'Anonymous', amount: 3000, message: 'Support your education.', date: new Date('2025-09-03') }
                        ]
                    },
                    {
                        id: 'camp_014',
                        title: 'Medical Treatment for Elderly Artist',
                        description: 'A renowned local artist, Mrs. Sharma, needs urgent treatment for a critical heart condition. Her family is struggling to raise the ₹10 lakhs required for the surgery. Your contribution can help her recover and continue her artistic legacy.',
                        goal: 1000000,
                        raised: 400000,
                        organizer: { name: 'Friends of Mrs. Sharma', uid: 'user_015' },
                        category: 'medical',
                        location: 'Kolkata, West Bengal',
                        status: 'active',
                        urgent: true,
                        imageUrl: 'https://images.unsplash.com/photo-1516549655169-0a1dd7228f2d?w=400&h=300&fit=crop',
                        donors: 150,
                        daysLeft: 25,
                        duration: '40',
                        created: new Date('2025-09-19'),
                        isSampleCampaign: true,
                        verified: true,
                        donorsList: [
                            { name: 'Art Lovers Collective', amount: 10000, message: 'For Mrs. Sharma\'s health.', date: new Date('2025-09-18') },
                            { name: 'Anonymous', amount: 5000, message: 'Speedy recovery!', date: new Date('2025-09-17') }
                        ]
                    }
                ];

                // Ensure all 14 campaigns are loaded
                allCampaignsData.push(...campaignsData);

                console.log(`Initializing ${allCampaignsData.length} campaigns in Firestore...`);

                for (const campaign of allCampaignsData) {
                    try {
                        const { setDoc, doc } = window.firebaseServices;
                        const db = window.firebaseServices.db;

                        // Mark all sample campaigns as verified
                        campaign.verified = true;

                        // Generate donors, payouts, and updates for sample campaigns
                        if (campaign.isSampleCampaign) {
                            // Generate dummy donors (8-12 donors)
                            if (!campaign.donorsList || campaign.donorsList.length === 0) {
                                campaign.donorsList = generateDummyDonors(campaign);
                            }
                            
                            // Generate payouts (up to 90% of raised amount)
                            if (!campaign.payouts || campaign.payouts.length === 0) {
                                campaign.payouts = generatePayouts(campaign);
                            }
                            
                            // Generate updates (2-3 updates)
                            if (!campaign.updates || campaign.updates.length === 0) {
                                campaign.updates = generateUpdates(campaign);
                            }
                        }

                        // Convert image URLs to base64 for initial load if needed
                        if (campaign.imageUrl && !campaign.image) {
                           campaign.image = await urlToBase64(campaign.imageUrl);
                        }
                        if (campaign.imageUrls && campaign.imageUrls.length > 0 && (!campaign.images || campaign.images.length === 0)) {
                           campaign.images = [];
                           for(const url of campaign.imageUrls) {
                               campaign.images.push(await urlToBase64(url));
                           }
                        } else if (campaign.image && (!campaign.images || campaign.images.length === 0)) {
                            campaign.images = [campaign.image];
                        }

                        // Limit image size to 600KB during initialization
                        if (campaign.images) {
                            campaign.images = await Promise.all(campaign.images.map(async imgBase64 => {
                                return await limitImageSize(imgBase64, 600 * 1024); // 600KB
                            }));
                            campaign.image = campaign.images[0] || campaign.image; // Update main image if available
                        }

                        await setDoc(doc(db, 'campaigns', campaign.id), {
                            ...campaign,
                            created: campaign.created || new Date(),
                            updatedAt: new Date()
                        });
                        console.log(`✓ Initialized campaign: ${campaign.id}`);
                    } catch (error) {
                        console.error(`❌ Failed to initialize campaign ${campaign.id}:`, error);
                    }
                }
                // Reload from Firestore after initialization
                await loadDataFromStorage();
            } else {
                console.log(`✅ Loaded ${allCampaigns.length} campaigns from Firestore successfully`);
            }

            campaigns = allCampaigns.filter(c => c.status === 'active');
            renderCampaigns();
        }

        // Helper to convert URL to Base64 and limit size
        async function urlToBase64(url) {
            try {
                const response = await fetch(url);
                const blob = await response.blob();
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onloadend = () => resolve(reader.result);
                    reader.onerror = reject;
                    reader.readAsDataURL(blob);
                });
            } catch (error) {
                console.error('Error converting URL to base64:', error);
                return url; // Fallback to URL if conversion fails
            }
        }

        // Helper to resize image if it exceeds the limit
        async function limitImageSize(base64String, maxSize) {
            if (base64String.startsWith('data:image')) {
                const byteString = atob(base64String.split(',')[1]);
                if (byteString.length <= maxSize) {
                    return base64String; // Image is already within the limit
                }

                return new Promise((resolve, reject) => {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    const img = new Image();

                    img.onload = function() {
                        let width = img.width;
                        let height = img.height;
                        let quality = 1; // Start with max quality

                        // Calculate new dimensions while maintaining aspect ratio
                        const aspectRatio = width / height;
                        const maxWidth = 800; // Example max width
                        const maxHeight = 600; // Example max height

                        if (width > maxWidth) {
                            width = maxWidth;
                            height = width / aspectRatio;
                        }
                        if (height > maxHeight) {
                            height = maxHeight;
                            width = height * aspectRatio;
                        }

                        canvas.width = width;
                        canvas.height = height;
                        ctx.drawImage(img, 0, 0, width, height);

                        let resizedBase64 = canvas.toDataURL('image/jpeg', quality); // Default to JPEG
                        let resizedByteString = atob(resizedBase64.split(',')[1]);

                        while (resizedByteString.length > maxSize && quality > 0.1) {
                            quality -= 0.1;
                            resizedBase64 = canvas.toDataURL('image/jpeg', quality);
                            resizedByteString = atob(resizedBase64.split(',')[1]);
                        }

                        if (resizedByteString.length > maxSize) {
                            reject(new Error("Image could not be resized below 600KB"));
                        } else {
                            resolve(resizedBase64);
                        }
                    };
                    img.onerror = reject;
                    img.src = base64String;
                });
            }
            return base64String; // Not an image, return as is
        }

        // Image preview functions for campaign creation
        function previewCampaignImages(event) {
            const files = Array.from(event.target.files);
            const maxFiles = 5;
            const maxSize = 600 * 1024; // 600KB per image

            if (files.length > maxFiles) {
                showNotification(`You can only upload ${maxFiles} images maximum.`, 'warning');
                event.target.value = '';
                return;
            }

            const oversizedFiles = files.filter(file => file.size > maxSize);
            if (oversizedFiles.length > 0) {
                showNotification(`Some files exceed the ${maxSize / 1024}KB limit. Please upload smaller images.`, 'error');
                event.target.value = '';
                return;
            }

            const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png'];
            const invalidFiles = files.filter(file => !allowedTypes.includes(file.type));
            if (invalidFiles.length > 0) {
                showNotification('Only JPG and PNG image files are allowed.', 'error');
                event.target.value = '';
                return;
            }

            campaignImages = files.slice(0, maxFiles);
            const previewContainer = document.getElementById('imagePreview');
            previewContainer.innerHTML = '';

            campaignImages.forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const previewItem = document.createElement('div');
                    previewItem.className = 'image-preview-item';
                    previewItem.innerHTML = `
                        <img src="${e.target.result}" alt="Preview ${index + 1}">
                        <button type="button" class="image-preview-remove" onclick="removeCampaignImage(${index})">×</button>
                    `;
                    previewContainer.appendChild(previewItem);
                };
                reader.readAsDataURL(file);
            });
        }

        function removeCampaignImage(index) {
            campaignImages.splice(index, 1);

            const fileInput = document.getElementById('campaignImages');
            const dt = new DataTransfer();
            campaignImages.forEach(file => dt.items.add(file));
            fileInput.files = dt.files;

            previewCampaignImages({ target: fileInput });
        }

        // --- Firebase Auth & User Management ---
        function updateAuthUI() {
            const authSection = document.getElementById('authSection');
            const userMenu = document.getElementById('userMenu');
            const adminMenuItems = document.getElementById('adminMenuItems');

            if (currentUser) {
                authSection.style.display = 'none';
                userMenu.style.display = 'block';

                const initials = currentUser.name.charAt(0).toUpperCase();
                document.getElementById('userInitials').textContent = initials;

                document.getElementById('profileName').textContent = currentUser.name;
                document.getElementById('profileEmail').textContent = currentUser.email;
                document.getElementById('profilePhone').textContent = currentUser.phone || '+91-XXXXXXXXXX';
                document.getElementById('profileInitials').textContent = initials;

                if (currentUser.isAdmin) {
                    adminMenuItems.style.display = 'block';
                } else {
                    adminMenuItems.style.display = 'none';
                }

                updateVerificationUI();
            } else {
                authSection.style.display = 'flex';
                userMenu.style.display = 'none';
            }
        }

        async function logout() {
            try {
                if (window.firebaseServices) {
                    await window.firebaseServices.signOut(window.firebaseServices.auth);
                }
                currentUser = null;
                userVerificationStatus = 'unverified';
                localStorage.removeItem('currentUser');
                localStorage.removeItem('userVerificationStatus');
                updateAuthUI();
                showHomePage();
                showNotification('Logged out successfully', 'success');
            } catch (error) {
                showNotification('Logout failed: ' + error.message, 'error');
            }
        }

        // --- Campaign Creation ---
        async function createCampaign() {
            if (!currentUser) {
                showNotification('Please login to create a campaign', 'warning');
                openModal('loginModal');
                return;
            }

            const formData = new FormData(document.getElementById('campaignForm'));
            const title = formData.get('title');
            const category = formData.get('category');
            const goal = parseInt(formData.get('goal'));
            const location = formData.get('location');
            const duration = formData.get('duration');
            const description = formData.get('description');

            if (!title || !category || !goal || !location || !duration || !description) {
                showNotification('Please fill in all required fields.', 'warning');
                return;
            }

            if (campaignImages.length === 0) {
                showNotification('Please upload at least one campaign image.', 'warning');
                return;
            }

            try {
                showNotification('Uploading images and creating campaign...', 'info');
                let uploadedImageUrls = [];

                // Upload images to Firebase Storage and get URLs
                for (const file of campaignImages) {
                    const fileRef = window.firebaseServices.storageRef(window.firebaseServices.storage, `campaign_images/${Date.now()}_${file.name}`);
                    const snapshot = await window.firebaseServices.uploadBytes(fileRef, file);
                    const downloadURL = await window.firebaseServices.getDownloadURL(snapshot.ref);
                    uploadedImageUrls.push(downloadURL);
                }

                const campaignData = {
                    title: title,
                    category: category,
                    description: description,
                    goalAmount: goal,
                    goal: goal,
                    location: location,
                    duration: duration,
                    raisedAmount: 0,
                    raised: 0,
                    organizer: {
                        uid: currentUser.uid,
                        name: currentUser.name,
                        email: currentUser.email
                    },
                    status: 'pending', // Start as pending approval
                    donors: 0,
                    daysLeft: duration === 'ongoing' ? 999 : parseInt(duration),
                    urgent: false, // Default to false, can be set by admin
                    imageUrl: uploadedImageUrls[0], // Main image URL
                    images: uploadedImageUrls, // Array of all image URLs
                    created: new Date(),
                    updatedAt: new Date()
                };

                const newCampaign = {
                    id: 'camp_' + Date.now(), // Temporary ID for local update
                    ...campaignData
                };

                // Save to Firestore
                const firestoreId = await saveCampaignToFirestore(newCampaign);
                newCampaign.id = firestoreId; // Update with actual ID

                allCampaigns.push(newCampaign); // Add to allCampaigns array
                campaigns.push(newCampaign); // Add to active campaigns if status is active (though it's pending now)

                closeModal('createCampaignModal');
                document.getElementById('campaignForm').reset();
                document.getElementById('imagePreview').innerHTML = '';
                campaignImages = []; // Clear preview images

                showNotification('Campaign submitted for review! You will be notified once approved by the admin.', 'success');
                renderCampaigns(); // Re-render to show the new campaign if it becomes active immediately or in admin panel
                if(currentUser.isAdmin) renderAdminPanel();

            } catch (error) {
                showNotification('Failed to create campaign: ' + error.message, 'error');
                console.error("Campaign creation error:", error);
            }
        }

        // --- Admin Functions ---
        function renderAdminPanel() {
            if (!currentUser || !currentUser.isAdmin) return;

            const pendingContainer = document.getElementById('pendingCampaigns');
            const allContainer = document.getElementById('allCampaignsAdmin');

            const pendingCampaigns = allCampaigns.filter(c => c.status === 'pending');

            if (pendingCampaigns.length === 0) {
                pendingContainer.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: var(--gray);">
                        <i class="fas fa-clipboard-check"></i>
                        <h3>No Pending Approvals</h3>
                        <p>All campaigns are currently approved or rejected.</p>
                    </div>
                `;
            } else {
                pendingContainer.innerHTML = pendingCampaigns.map(campaign => `
                    <div class="campaign-card" style="margin-bottom: 1rem;">
                        <div class="campaign-content">
                            <h3 class="campaign-title">${campaign.title}</h3>
                            <p class="campaign-organizer">by ${campaign.organizer.name} • ${campaign.location}</p>
                            <p class="campaign-description">${campaign.description}</p>
                            <p><strong>Goal:</strong> ₹${(campaign.goalAmount || campaign.goal).toLocaleString()}</p>
                            <p><strong>Category:</strong> ${campaign.category}</p>
                            <p><strong>Duration:</strong> ${campaign.duration === 'ongoing' ? 'Ongoing' : campaign.duration + ' days'}</p>
                            <div style="display: flex; gap: 1rem; margin-top: 1rem; flex-wrap: wrap;">
                                <button class="btn btn-primary btn-small" onclick="approveCampaign('${campaign.id}')">
                                    <i class="fas fa-check"></i> Approve
                                </button>
                                <button class="btn btn-danger btn-small" onclick="rejectCampaign('${campaign.id}')">
                                    <i class="fas fa-times"></i> Reject
                                </button>
                                <button class="btn btn-outline btn-small" onclick="editCampaignAsAdmin('${campaign.id}')">
                                    <i class="fas fa-edit"></i> Edit Campaign
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            allContainer.innerHTML = allCampaigns.map(campaign => `
                <div class="campaign-card" style="margin-bottom: 1rem;">
                    <div class="campaign-content">
                        <h3 class="campaign-title">${campaign.title}</h3>
                        <p class="campaign-organizer">by ${campaign.organizer.name} • ${campaign.location}</p>
                        <p><strong>Status:</strong> <span style="color: ${campaign.status === 'active' ? '#28a745' : campaign.status === 'pending' ? '#f57c00' : '#6c757d'};">${campaign.status.toUpperCase()}</span></p>
                        <p><strong>Raised:</strong> ₹${(campaign.raised || campaign.raisedAmount || 0).toLocaleString()} / ₹${(campaign.goal || campaign.goalAmount).toLocaleString()}</p>
                        <div style="display: flex; gap: 1rem; margin-top: 1rem; flex-wrap: wrap;">
                            <button class="btn btn-outline btn-small" onclick="editCampaignAsAdmin('${campaign.id}')">
                                <i class="fas fa-edit"></i> Edit Details
                            </button>
                            <button class="btn btn-warning btn-small" onclick="manageCampaignImages('${campaign.id}')">
                                <i class="fas fa-images"></i> Manage Images
                            </button>
                            <button class="btn btn-secondary btn-small" onclick="setPaymentLink('${campaign.id}')">
                                <i class="fas fa-link"></i> Payment Link
                            </button>
                            <button class="btn ${campaign.verified ? 'btn-success' : 'btn-outline'} btn-small" onclick="toggleVerification('${campaign.id}')">
                                <i class="fas fa-${campaign.verified ? 'check-circle' : 'times-circle'}"></i> ${campaign.verified ? 'Verified' : 'Unverified'}
                            </button>
                            <button class="btn btn-danger btn-small" onclick="deleteCampaign('${campaign.id}')">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        async function approveCampaign(campaignId) {
            const campaign = allCampaigns.find(c => c.id === campaignId);
            if (!campaign || !currentUser || !currentUser.isAdmin) return;

            campaign.status = 'active';
            campaign.verified = true; // Mark as verified upon approval
            campaign.updatedAt = new Date();

            await saveCampaignToFirestore(campaign);
            showNotification('Campaign approved and is now live!', 'success');
            renderAdminPanel();
            renderCampaigns(); // Update the main campaign list
        }

        async function rejectCampaign(campaignId) {
            if (currentUser && currentUser.isAdmin) {
                if (confirm('Are you sure you want to reject this campaign? This action cannot be undone.')) {
                    await deleteCampaignFromFirestore(campaignId);
                    allCampaigns = allCampaigns.filter(c => c.id !== campaignId);
                    campaigns = campaigns.filter(c => c.id !== campaignId); // Remove from active list too
                    showNotification('Campaign rejected and removed.', 'success');
                    renderAdminPanel();
                    renderCampaigns();
                }
            }
        }

        async function deleteCampaign(campaignId) {
            const campaign = allCampaigns.find(c => c.id === campaignId);
            if (!campaign) return;

            const canDelete = currentUser && (
                currentUser.isAdmin ||
                (campaign.organizer && campaign.organizer.uid === currentUser.uid)
            );

            if (!canDelete) {
                showNotification('You do not have permission to delete this campaign.', 'error');
                return;
            }

            if (confirm('Are you sure you want to delete this campaign? This action cannot be undone.')) {
                try {
                    await deleteCampaignFromFirestore(campaignId);
                    allCampaigns = allCampaigns.filter(c => c.id !== campaignId);
                    campaigns = allCampaigns.filter(c => c.id !== campaignId);
                    showNotification('Campaign deleted successfully.', 'success');
                    renderCampaigns(); // Re-render carousel
                    if(currentUser.isAdmin) renderAdminPanel(); // Re-render admin panel
                } catch (error) {
                    showNotification('Failed to delete campaign: ' + error.message, 'error');
                }
            }
        }

        async function editCampaignAsAdmin(campaignId) {
            const campaign = allCampaigns.find(c => c.id === campaignId);
            if (!campaign || !currentUser || !currentUser.isAdmin) return;

            document.getElementById('adminEditTitle').value = campaign.title;
            document.getElementById('adminEditDescription').value = campaign.description;
            document.getElementById('adminEditGoal').value = campaign.goal || campaign.goalAmount;
            document.getElementById('adminEditImage').value = campaign.imageUrl || '';
            document.getElementById('adminEditPaymentLink').value = campaign.paymentLink || '';
            document.getElementById('adminEditStatus').value = campaign.status || 'active';
            
            // Set start date if available
            if (campaign.created) {
                const dateObj = campaign.created instanceof Date ? campaign.created : new Date(campaign.created);
                const localDateTime = new Date(dateObj.getTime() - (dateObj.getTimezoneOffset() * 60000)).toISOString().slice(0, 16);
                document.getElementById('adminEditStartDate').value = localDateTime;
            }

            document.getElementById('adminEditForm').dataset.campaignId = campaignId;
            openModal('adminEditModal');
        }

        async function saveAdminEdit() {
            const campaignId = document.getElementById('adminEditForm').dataset.campaignId;
            const campaign = allCampaigns.find(c => c.id === campaignId);
            if (!campaign) {
                showNotification('Campaign not found!', 'error');
                return;
            }

            showNotification('Saving changes...', 'info');

            try {
                const startDateValue = document.getElementById('adminEditStartDate').value;
                const updatedCampaign = {
                    ...campaign,
                    title: document.getElementById('adminEditTitle').value,
                    description: document.getElementById('adminEditDescription').value,
                    goal: parseInt(document.getElementById('adminEditGoal').value),
                    goalAmount: parseInt(document.getElementById('adminEditGoal').value),
                    paymentLink: document.getElementById('adminEditPaymentLink').value.trim(),
                    status: document.getElementById('adminEditStatus').value,
                    created: startDateValue ? new Date(startDateValue) : campaign.created,
                    updatedAt: new Date()
                };

                const newImageUrl = document.getElementById('adminEditImage').value.trim();
                if (newImageUrl && newImageUrl !== campaign.imageUrl) {
                    updatedCampaign.imageUrl = newImageUrl;
                    updatedCampaign.image = await urlToBase64(newImageUrl);
                    if (!updatedCampaign.images) updatedCampaign.images = [];
                    updatedCampaign.images[0] = updatedCampaign.image;
                }

                // Save to Firebase
                const { setDoc, doc } = window.firebaseServices;
                const db = window.firebaseServices.db;
                await setDoc(doc(db, 'campaigns', campaignId), updatedCampaign);

                // Update local arrays - this ensures changes persist across the app
                const campaignIndex = allCampaigns.findIndex(c => c.id === campaignId);
                if (campaignIndex !== -1) {
                    allCampaigns[campaignIndex] = updatedCampaign;
                }
                campaigns = allCampaigns.filter(c => c.status === 'active');

                console.log('✅ Admin changes saved and synced:', campaignId);
                closeModal('adminEditModal');
                showNotification('✅ Changes saved successfully!', 'success');

                // Re-render all components
                renderCampaigns();
                if (currentUser.isAdmin) renderAdminPanel();

                // Update campaign detail view if open
                if (document.getElementById('campaignDetail').classList.contains('active') && currentCampaignId === campaignId) {
                    viewCampaign(campaignId);
                }

            } catch (error) {
                console.error('❌ Save failed:', error);
                showNotification('Failed to save: ' + error.message, 'error');
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            const adminEditForm = document.getElementById('adminEditForm');
            if (adminEditForm) {
                adminEditForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    await saveAdminEdit();
                });
            }
        });

        async function manageCampaignImages(campaignId) {
            const campaign = allCampaigns.find(c => c.id === campaignId);
            if (!campaign || !currentUser || !currentUser.isAdmin) return;

            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = 'image/*';
            fileInput.multiple = true;
            fileInput.style.display = 'none';

            fileInput.onchange = async function(event) {
                const files = Array.from(event.target.files);
                if (files.length === 0) return;

                const maxFiles = 5;
                const maxSize = 600 * 1024; // 600KB

                if (files.length > maxFiles) {
                    showNotification(`Max ${maxFiles} images. Using first ${maxFiles}.`, 'warning');
                    files.splice(maxFiles);
                }

                const oversizedFiles = files.filter(file => file.size > maxSize);
                if (oversizedFiles.length > 0) {
                    showNotification(`Some files exceed the ${maxSize / 1024}KB limit. Please upload smaller images.`, 'error');
                    event.target.value = '';
                    return;
                }

                showNotification(`Uploading ${files.length} image(s)...`, 'info');

                try {
                    const uploadedImageUrls = [];
                    for (const file of files) {
                        const fileRef = window.firebaseServices.storageRef(window.firebaseServices.storage, `campaign_images/${Date.now()}_${file.name}`);
                        const snapshot = await window.firebaseServices.uploadBytes(fileRef, file);
                        const downloadURL = await window.firebaseServices.getDownloadURL(snapshot.ref);
                        uploadedImageUrls.push(downloadURL);
                    }

                    const updatedCampaign = {
                        ...campaign,
                        images: uploadedImageUrls,
                        imageUrl: uploadedImageUrls[0] || campaign.imageUrl, // Update main image URL
                        image: uploadedImageUrls[0] || campaign.image, // Also update the 'image' field for card display
                        updatedAt: new Date()
                    };

                    const { setDoc, doc } = window.firebaseServices;
                    const db = window.firebaseServices.db;
                    await setDoc(doc(db, 'campaigns', campaignId), updatedCampaign);

                    console.log('✅ Images saved:', campaignId);
                    showNotification(`✅ ${uploadedImageUrls.length} image(s) saved!`, 'success');

                    allCampaigns = allCampaigns.map(c => c.id === campaignId ? updatedCampaign : c);
                    campaigns = allCampaigns.filter(c => c.status === 'active');
                    renderCampaigns();

                } catch (error) {
                    console.error('❌ Upload failed:', error);
                    showNotification('Upload failed: ' + error.message, 'error');
                }

                document.body.removeChild(fileInput);
            };

            document.body.appendChild(fileInput);
            fileInput.click();
        }

        async function setPaymentLink(campaignId) {
            const campaign = allCampaigns.find(c => c.id === campaignId);
            if (!campaign || !currentUser || !currentUser.isAdmin) return;

            const paymentLink = prompt(`Enter payment link for "${campaign.title}":\n\n• Razorpay: https://rzp.io/l/xxx\n• UPI: upi://pay?pa=...\n• Custom URL`, campaign.paymentLink || '');

            if (paymentLink !== null) {
                showNotification('Saving...', 'info');

                try {
                    const updatedCampaign = {
                        ...campaign,
                        paymentLink: paymentLink.trim(),
                        updatedAt: new Date()
                    };

                    const { setDoc, doc } = window.firebaseServices;
                    const db = window.firebaseServices.db;
                    await setDoc(doc(db, 'campaigns', campaignId), updatedCampaign);

                    console.log('✅ Payment link saved:', campaignId);
                    showNotification(paymentLink.trim() ? '✅ Payment link saved!' : 'Payment link removed.', 'success');

                    allCampaigns = allCampaigns.map(c => c.id === campaignId ? updatedCampaign : c);
                    campaigns = allCampaigns.filter(c => c.status === 'active');
                    renderCampaigns();

                } catch (error) {
                    console.error('❌ Save failed:', error);
                    showNotification('Failed: ' + error.message, 'error');
                }
            }
        }

        async function toggleVerification(campaignId) {
            const campaign = allCampaigns.find(c => c.id === campaignId);
            if (!campaign || !currentUser || !currentUser.isAdmin) return;

            const newVerifiedStatus = !campaign.verified;
            
            try {
                showNotification('Updating verification status...', 'info');

                const updatedCampaign = {
                    ...campaign,
                    verified: newVerifiedStatus,
                    updatedAt: new Date()
                };

                const { setDoc, doc } = window.firebaseServices;
                const db = window.firebaseServices.db;
                await setDoc(doc(db, 'campaigns', campaignId), updatedCampaign);

                console.log('✅ Verification status updated:', campaignId);
                showNotification(`Campaign ${newVerifiedStatus ? 'verified' : 'unverified'} successfully!`, 'success');

                allCampaigns = allCampaigns.map(c => c.id === campaignId ? updatedCampaign : c);
                campaigns = allCampaigns.filter(c => c.status === 'active');
                renderCampaigns();
                if (currentUser.isAdmin) renderAdminPanel();

            } catch (error) {
                console.error('❌ Verification update failed:', error);
                showNotification('Failed to update verification: ' + error.message, 'error');
            }
        }

        // --- Campaign Detail Page ---
        function viewCampaign(campaignId) {
            const campaign = allCampaigns.find(c => c.id === campaignId);
            if (!campaign) return;

            currentCampaignId = campaignId;
            
            // Check if user can manage this campaign
            const canManage = currentUser && (
                currentUser.isAdmin || 
                (campaign.organizer && campaign.organizer.uid === currentUser.uid)
            );

            document.getElementById('homePage').style.display = 'none';
            document.getElementById('profileSection').classList.remove('active');
            document.getElementById('verificationSection').classList.remove('active');
            document.getElementById('withdrawalsSection').classList.remove('active');
            document.getElementById('adminPanel').classList.remove('active');
            document.getElementById('campaignDetail').classList.add('active');

            // Scroll to top of page
            window.scrollTo({ top: 0, behavior: 'smooth' });

            // Handle multiple images in carousel
            const campaignImagesCarousel = document.getElementById('campaignImagesCarousel');
            // Get images from imageUrls or images array, fallback to single image or imageUrl
            const images = campaign.imageUrls || campaign.images || (campaign.imageUrl ? [campaign.imageUrl] : (campaign.image ? [campaign.image] : []));

            if (images.length > 0) {
                campaignImagesCarousel.innerHTML = images.map((img, idx) => `
                    <img src="${img}" alt="${campaign.title} - Image ${idx + 1}" style="width: 100%; height: 100%; object-fit: cover; flex-shrink: 0; scroll-snap-align: start;">
                `).join('');

                // Add navigation for multiple images
                if (images.length > 1) {
                    const prevBtn = document.createElement('button');
                    prevBtn.className = 'carousel-nav prev';
                    prevBtn.innerHTML = '<i class="fas fa-chevron-left"></i>';
                    prevBtn.style.position = 'absolute';
                    prevBtn.style.top = '50%';
                    prevBtn.style.left = '10px';
                    prevBtn.style.transform = 'translateY(-50%)';
                    prevBtn.onclick = () => campaignImagesCarousel.scrollBy({ left: -campaignImagesCarousel.offsetWidth, behavior: 'smooth' });

                    const nextBtn = document.createElement('button');
                    nextBtn.className = 'carousel-nav next';
                    nextBtn.innerHTML = '<i class="fas fa-chevron-right"></i>';
                    nextBtn.style.position = 'absolute';
                    nextBtn.style.top = '50%';
                    nextBtn.style.right = '10px';
                    nextBtn.style.transform = 'translateY(-50%)';
                    nextBtn.onclick = () => campaignImagesCarousel.scrollBy({ left: campaignImagesCarousel.offsetWidth, behavior: 'smooth' });

                    document.querySelector('.campaign-hero').appendChild(prevBtn);
                    document.querySelector('.campaign-hero').appendChild(nextBtn);
                }
            } else {
                campaignImagesCarousel.innerHTML = `<img src="${getDefaultCategoryImage(campaign.category)}" alt="${campaign.title}" style="width: 100%; height: 100%; object-fit: cover;">`;
            }
            document.getElementById('detailCampaignTitle').textContent = campaign.title;
            document.getElementById('detailCampaignOrganizer').textContent = campaign.organizer.name;
            document.getElementById('detailCampaignLocation').textContent = campaign.location;
            document.getElementById('detailCampaignDate').textContent = formatDate(campaign.created);

            const raised = campaign.raised || campaign.raisedAmount || 0;
            const goal = campaign.goal || campaign.goalAmount;
            const progress = Math.min((raised / goal) * 100, 100);

            document.getElementById('detailProgressFill').style.width = progress + '%';
            document.getElementById('detailAmountRaised').textContent = '₹' + raised.toLocaleString();
            document.getElementById('detailGoalAmount').textContent = '₹' + goal.toLocaleString();
            document.getElementById('detailDonorCount').textContent = (campaign.donors || 0) + ' donors';
            document.getElementById('detailDaysLeft').textContent = (campaign.daysLeft === 999 ? 'Ongoing' : campaign.daysLeft + ' days left');
            document.getElementById('detailCampaignStory').textContent = campaign.description;

            const badge = document.getElementById('detailCampaignBadge');
            if (campaign.urgent) {
                badge.textContent = 'URGENT';
                badge.className = 'campaign-badge urgent-badge';
            } else {
                badge.textContent = campaign.status.toUpperCase();
                badge.className = 'campaign-badge';
            }

            // Load payouts from Firebase or generate for sample campaigns
            const payouts = campaign.payouts || (campaign.isSampleCampaign ? generatePayouts(campaign) : []);
            const payoutsContainer = document.getElementById('payoutsList');
            document.getElementById('payoutCount').textContent = payouts.length;

            if (payouts.length > 0) {
                payoutsContainer.innerHTML = payouts.map(payout => `
                    <div class="payout-item">
                        <div class="payout-header">
                            <div class="payout-amount">₹${payout.amount.toLocaleString()}</div>
                            <div class="payout-date">${formatDate(payout.date)}</div>
                        </div>
                        <div class="payout-purpose">${payout.purpose}</div>
                    </div>
                `).join('');
            } else {
                payoutsContainer.innerHTML = '<div class="empty-state"><i class="fas fa-wallet"></i><h3>No Payouts Yet</h3><p>Payouts will appear here once funds are withdrawn</p></div>';
            }
            
            // Show add payout section for admin/creator
            const addPayoutSection = document.getElementById('addPayoutSection');
            if (canManage && addPayoutSection) {
                addPayoutSection.style.display = 'block';
            }

            // Load updates from Firebase or generate for sample campaigns
            const updates = campaign.updates || (campaign.isSampleCampaign ? generateUpdates(campaign) : []);
            const updatesContainer = document.getElementById('updatesList');
            document.getElementById('updateCount').textContent = updates.length;

            if (updates.length > 0) {
                updatesContainer.innerHTML = updates.map(update => `
                <div class="update-item">
                    <div class="update-header">
                        <div class="update-title">${update.title}</div>
                        <div class="update-date">${formatDate(update.date)}</div>
                    </div>
                    <div class="update-text">${update.text}</div>
                </div>
            `).join('');
            } else {
                updatesContainer.innerHTML = '<div class="empty-state"><i class="fas fa-bell"></i><h3>No Updates Yet</h3><p>Campaign updates will appear here as the organizer shares progress.</p></div>';
            }
            
            // Show add update section for admin/creator
            const addUpdateSection = document.getElementById('addUpdateSection');
            if (canManage && addUpdateSection) {
                addUpdateSection.style.display = 'block';
            }

            // Reset to story tab
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector('.tab-btn').classList.add('active');
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById('storyTab').classList.add('active');

            loadDonors(campaign); // Load donors
        }

        function loadDonors(campaign) {
            const donorsList = document.getElementById('donorsList');

            let donors = [];
            
            // Always prioritize actual donors from donorsList
            if (campaign.donorsList && campaign.donorsList.length > 0) {
                donors = campaign.donorsList;
            } else if (campaign.isSampleCampaign) {
                // Generate sample donors only for sample campaigns
                donors = generateDummyDonors(campaign);
            }

            if (donors.length === 0) {
                donorsList.innerHTML = '<div class="empty-state"><i class="fas fa-users"></i><h3>No Donations Yet</h3><p>Be the first to support this campaign!</p></div>';
                return;
            }

            // Sort donors by date (most recent first)
            donors.sort((a, b) => {
                const dateA = a.date instanceof Date ? a.date : new Date(a.date);
                const dateB = b.date instanceof Date ? b.date : new Date(b.date);
                return dateB - dateA;
            });

            donorsList.innerHTML = donors.map(donor => `
                <div class="donor-item">
                    <div class="donor-info">
                        <h4>${donor.name}</h4>
                        <p style="color: var(--gray); font-size: 0.9rem;">${donor.message || 'Thank you for your support!'}</p>
                        ${donor.date ? `<small style="color: var(--gray);">${formatDate(donor.date)}</small>` : ''}
                    </div>
                    <div class="donor-amount">₹${donor.amount.toLocaleString()}</div>
                </div>
            `).join('');
        }

        // --- Donation Process ---
        function showDonationModal(campaignId) {
            const campaign = allCampaigns.find(c => c.id === campaignId);
            if (!campaign) return;

            currentCampaignId = campaignId;

            const raised = campaign.raised || campaign.raisedAmount || 0;
            const goal = campaign.goal || campaign.goalAmount;

            document.getElementById('donationCampaignInfo').innerHTML = `
                <div style="background: var(--light); padding: 1.5rem; border-radius: 8px;">
                    <h3>${campaign.title}</h3>
                    <p style="color: var(--gray); margin: 0.5rem 0;">by ${campaign.organizer.name}</p>
                    <div style="display: flex; justify-content: space-between; margin-top: 1rem;">
                        <span><strong>Goal:</strong> ₹${goal.toLocaleString()}</span>
                        <span><strong>Raised:</strong> ₹${raised.toLocaleString()}</span>
                    </div>
                </div>
            `;

            if (currentUser) {
                document.getElementById('donorName').value = currentUser.name;
                document.getElementById('donorEmail').value = currentUser.email;
            } else {
                document.getElementById('donorName').value = '';
                document.getElementById('donorEmail').value = '';
            }

            openModal('donationModal');
        }

        function openDonationModal(campaignId) {
            if (campaignId) {
                showDonationModal(campaignId);
            } else if (currentCampaignId) {
                showDonationModal(currentCampaignId);
            }
        }

        function setDonationAmount(amount) {
            document.getElementById('donationAmount').value = amount;
        }

        async function processDonation(amount, name, email, message) {
            const campaign = allCampaigns.find(c => c.id === currentCampaignId);
            if (!campaign) return;

            if (!amount || !name || !email) {
                showNotification('Please enter donation amount, your name, and email.', 'warning');
                return;
            }

            try {
                // If campaign has a payment link, redirect
                if (campaign.paymentLink) {
                    const paymentUrl = campaign.paymentLink.includes('?')
                        ? `${campaign.paymentLink}&amount=${amount}&name=${encodeURIComponent(name)}&email=${encodeURIComponent(email)}`
                        : `${campaign.paymentLink}?amount=${amount}&name=${encodeURIComponent(name)}&email=${encodeURIComponent(email)}`;

                    sessionStorage.setItem('pendingDonation', JSON.stringify({
                        campaignId: currentCampaignId, amount, name, email, message
                    }));

                    window.open(paymentUrl, '_blank');
                    closeModal('donationModal');
                    showNotification('Redirecting to payment gateway...', 'info');
                } else {
                    // Fallback: Process directly (for demo purposes, actual implementation would use a payment gateway)
                    await completeDonation(currentCampaignId, amount, name, email, message);
                    closeModal('donationModal');
                    document.getElementById('donationForm').reset();
                }
            } catch (error) {
                showNotification('Donation failed: ' + error.message, 'error');
            }
        }

        async function completeDonation(campaignId, amount, name, email, message) {
            const campaignIndex = allCampaigns.findIndex(c => c.id === campaignId);
            if (campaignIndex === -1) return;

            const campaign = allCampaigns[campaignIndex];
            const updatedCampaign = { ...campaign }; // Create a mutable copy

            const currentRaised = updatedCampaign.raised || updatedCampaign.raisedAmount || 0;
            const currentDonors = updatedCampaign.donors || 0;

            updatedCampaign.raised = currentRaised + parseInt(amount);
            updatedCampaign.raisedAmount = updatedCampaign.raised;
            updatedCampaign.donors = currentDonors + 1;

            if (!updatedCampaign.donorsList) {
                updatedCampaign.donorsList = [];
            }
            updatedCampaign.donorsList.unshift({
                name: name,
                amount: parseInt(amount),
                message: message || 'Thank you for your support!',
                date: new Date(),
                email: email // Include email for potential future use/filtering
            });
            updatedCampaign.updatedAt = new Date();

            await saveCampaignToFirestore(updatedCampaign);

            // Update local arrays
            allCampaigns[campaignIndex] = updatedCampaign;
            campaigns = allCampaigns.filter(c => c.status === 'active'); // Re-filter active campaigns

            // Update donor list if on campaign detail page
            if (document.getElementById('campaignDetail').classList.contains('active')) {
                loadDonors(updatedCampaign);
            }

            await sendThankYouEmail(name, email, amount, updatedCampaign.title);

            renderCampaigns(); // Re-render carousel
            if(currentUser.isAdmin) renderAdminPanel(); // Re-render admin panel

            showNotification(`Thank you ${name}! Your donation of ₹${amount} has been processed successfully.`, 'success');
        }

        async function sendThankYouEmail(donorName, donorEmail, amount, campaignTitle) {
            try {
                const templateParams = {
                    to_name: donorName,
                    to_email: donorEmail,
                    donation_amount: amount.toLocaleString(),
                    campaign_title: campaignTitle,
                    from_name: 'Flapping Bird Team',
                    message: `\u{1F64F} Thank you for your generous donation, ${donorName}!\n\nYour donation of ₹${amount.toLocaleString()} to "${campaignTitle}" has been processed successfully.\n\nYour kindness and generosity make a real difference in someone's life. Because of donors like you, we can continue to support those who need it most.\n\nYou will receive a tax receipt shortly for your donation.\n\nWith gratitude,\nTeam Flapping Bird\n\n"Small acts of kindness create ripples of change that reach far beyond what we can see."`
                };
                await emailjs.send('service_1xqntbe', 'template_tiupsnw', templateParams);
                console.log('Thank you email sent successfully to:', donorEmail);
            } catch (error) {
                console.error('Failed to send thank you email:', error);
            }
        }

        // --- Navigation & UI ---
        function showHomePage() {
            document.getElementById('homePage').style.display = 'block';
            document.getElementById('campaignDetail').classList.remove('active');
            document.getElementById('adminPanel').classList.remove('active');
            document.getElementById('profileSection').classList.remove('active');
            document.getElementById('verificationSection').classList.remove('active');
            document.getElementById('withdrawalsSection').classList.remove('active');
            document.getElementById('myDonationsSection').classList.remove('active');
            document.getElementById('settingsSection').classList.remove('active');
        }

        function showProfile() {
            if (!currentUser) {
                showNotification('Please login to view your profile.', 'warning');
                openModal('loginModal');
                return;
            }

            document.getElementById('homePage').style.display = 'none';
            document.getElementById('campaignDetail').classList.remove('active');
            document.getElementById('adminPanel').classList.remove('active');
            document.getElementById('profileSection').classList.add('active');
            document.getElementById('verificationSection').classList.remove('active');
            document.getElementById('withdrawalsSection').classList.remove('active');
            document.getElementById('myDonationsSection').classList.remove('active');
            document.getElementById('settingsSection').classList.remove('active');

            updateVerificationUI();
            loadUserCampaigns();
            document.getElementById('dropdownMenu').style.display = 'none';
        }

        function showMyCampaigns() { showProfile(); } // Alias for profile

        function editProfile() { showNotification('Profile editing feature coming soon!', 'info'); }

        function showAdminPanel() {
            if (!currentUser || !currentUser.isAdmin) {
                showNotification('Access denied. Admin privileges required.', 'error');
                return;
            }
            document.getElementById('homePage').style.display = 'none';
            document.getElementById('campaignDetail').classList.remove('active');
            document.getElementById('adminPanel').classList.add('active');
            document.getElementById('profileSection').classList.remove('active');
            document.getElementById('verificationSection').classList.remove('active');
            document.getElementById('withdrawalsSection').classList.remove('active');
            document.getElementById('myDonationsSection').classList.remove('active');
            document.getElementById('settingsSection').classList.remove('active');
            renderAdminPanel();
        }

        function filterCampaigns(category) {
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[data-filter="${category}"]`).classList.add('active');
            renderCampaigns(category);
        }

        function checkAuthAndStartCampaign() {
            if (!currentUser) {
                openModal('loginModal');
                return;
            }
            openModal('createCampaignModal');
        }

        function openDonationModal() {
            if (currentCampaignId) {
                showDonationModal(currentCampaignId);
            }
        }

        function shareCampaign() {
            if (currentCampaignId) {
                const campaignUrl = `${window.location.origin}?campaign=${currentCampaignId}`;
                if (navigator.share) {
                    navigator.share({ title: 'Support this campaign', text: 'Help make a difference by supporting this fundraising campaign', url: campaignUrl });
                } else {
                    navigator.clipboard.writeText(campaignUrl).then(() => {
                        showNotification('Campaign link copied to clipboard!', 'success');
                    }).catch(() => {
                        showNotification('Campaign URL: ' + campaignUrl, 'info');
                    });
                }
            }
        }

        // --- Modals & Notifications ---
        function openModal(modalId) { document.getElementById(modalId).style.display = 'block'; }
        function closeModal(modalId) { document.getElementById(modalId).style.display = 'none'; }
        function toggleDropdown() {
            const dropdown = document.getElementById('dropdownMenu');
            dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            setTimeout(() => notification.classList.add('show'), 10);
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => document.body.removeChild(notification), 300);
            }, 3000);
        }

        // --- OTP Verification ---
        let pendingSignupData = null;
        let generatedOTP = null;
        let otpExpiryTime = null;

        async function sendSignupOTP(name, email) {
            try {
                generatedOTP = Math.floor(100000 + Math.random() * 900000).toString();
                otpExpiryTime = Date.now() + (15 * 60 * 1000); // 15 minutes

                const templateParams = { to_name: name, to_email: email, otp_code: generatedOTP, from_name: 'Flapping Bird Team', message: `Your OTP for Flapping Bird account verification is: ${generatedOTP}. This OTP will expire in 15 minutes. Please do not share this code with anyone.` };
                await emailjs.send('service_1xqntbe', 'template_3dhsz8r', templateParams);

                closeModal('signupModal');
                openModal('otpModal');
                document.getElementById('otpEmail').textContent = email;
                document.getElementById('otpCode').value = '';
                startOTPTimer();
                showNotification('OTP sent successfully! Please check your email.', 'success');
            } catch (error) {
                showNotification('Failed to send OTP: ' + error.message, 'error');
                if (document.getElementById('otpModal').style.display === 'block') {
                    closeModal('otpModal');
                    openModal('signupModal');
                }
            }
        }

        function startOTPTimer() {
            const timerElement = document.getElementById('otpTimer');
            const resendButton = document.getElementById('resendOTP');
            let timeLeft = 900; // 15 minutes
            resendButton.style.display = 'none';

            const timer = setInterval(() => {
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                timerElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    timerElement.textContent = 'OTP Expired';
                    resendButton.style.display = 'inline-block';
                    generatedOTP = null;
                    otpExpiryTime = null;
                }
                timeLeft--;
            }, 1000);
        }

        async function verifyOTP() {
            const enteredOTP = document.getElementById('otpCode').value.trim();
            if (!enteredOTP) { showNotification('Please enter the OTP code.', 'warning'); return; }
            if (enteredOTP.length !== 6) { showNotification('OTP must be 6 digits.', 'warning'); return; }
            if (!generatedOTP || Date.now() > otpExpiryTime) { showNotification('OTP has expired. Please request a new one.', 'error'); document.getElementById('resendOTP').style.display = 'inline-block'; return; }
            if (enteredOTP !== generatedOTP) { showNotification('Invalid OTP. Please check and try again.', 'error'); document.getElementById('otpCode').value = ''; return; }

            showNotification('OTP verified successfully! Creating your account...', 'success');
            await createAccountAfterOTP();
        }

        async function createAccountAfterOTP() {
            try {
                const { createUserWithEmailAndPassword } = window.firebaseServices;
                const { name, email, phone, password } = pendingSignupData;
                const userCredential = await createUserWithEmailAndPassword(window.firebaseServices.auth, email, password);

                await sendWelcomeEmail(name, email);

                showNotification('Account created successfully! Welcome to Flapping Bird.', 'success');
                const isAdmin = email === 'vishuu7306@gmail.com';
                currentUser = { uid: userCredential.user.uid, name: name, email: email, phone: phone, isAdmin: isAdmin };
                localStorage.setItem('currentUser', JSON.JSON.stringify(currentUser));
                updateAuthUI();
                closeModal('otpModal');
                pendingSignupData = null; generatedOTP = null; otpExpiryTime = null;
            } catch (error) {
                showNotification('Account creation failed: ' + error.message, 'error');
            }
        }

        async function sendWelcomeEmail(name, email) {
            try {
                const templateParams = { to_name: name, to_email: email, from_name: 'Flapping Bird Team', message: `\u{1F389} Welcome to Flapping Bird, ${name}!\n\nYour account has been created successfully. You can now:\n• Start your own fundraising campaign\n• Donate to causes you care about\n• Join our community of changemakers\n\nThank you for being part of India's most trusted crowdfunding platform. Together, we can make a difference!\n\nBest regards,\nTeam Flapping Bird` };
                await emailjs.send('service_1xqntbe', 'template_tiupsnw', templateParams);
                console.log('Welcome email sent successfully to:', email);
            } catch (error) {
                console.log('Welcome email sending failed (continuing anyway):', error);
            }
        }

        async function resendOTP() {
            if (pendingSignupData) {
                await sendSignupOTP(pendingSignupData.name, pendingSignupData.email);
            } else {
                showNotification('Session expired. Please start signup process again.', 'error');
                closeModal('otpModal'); openModal('signupModal');
            }
        }

        // --- Profile & Verification ---
        function saveProfilePicture(imageDataUrl) { if (currentUser) { localStorage.setItem(`profilePicture_${currentUser.uid}`, imageDataUrl); } }
        function loadProfilePicture() {
            if (currentUser) {
                const savedPicture = localStorage.getItem(`profilePicture_${currentUser.uid}`);
                if (savedPicture) {
                    document.querySelectorAll('#userAvatarNav, #profileAvatar').forEach(avatar => {
                        avatar.innerHTML = `<img src="${savedPicture}" alt="Profile Picture">`;
                    });
                }
            }
        }
        function uploadProfilePicture() { document.getElementById('profilePictureInput').click(); }
        async function handleProfilePictureUpload(event) {
            const file = event.target.files[0];
            if (!file || !currentUser) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                const imageDataUrl = e.target.result;
                document.querySelectorAll('#userAvatarNav, #profileAvatar').forEach(avatar => {
                    avatar.innerHTML = `<img src="${imageDataUrl}" alt="Profile Picture">`;
                });
                saveProfilePicture(imageDataUrl);
                showNotification('Profile picture updated successfully!', 'success');
            };
            reader.readAsDataURL(file);
        }
        function showVerificationForm() { document.getElementById('homePage').style.display = 'none'; document.getElementById('profileSection').classList.remove('active'); document.getElementById('verificationSection').classList.add('active'); document.getElementById('campaignDetail').classList.remove('active'); document.getElementById('adminPanel').classList.remove('active'); document.getElementById('withdrawalsSection').classList.remove('active'); }
        async function submitVerification() {
            const aadhaar = document.getElementById('aadhaarNumber').value; const pan = document.getElementById('panNumber').value;
            const bankAccount = document.getElementById('bankAccount').value; const ifscCode = document.getElementById('ifscCode').value;
            const bankName = document.getElementById('bankName').value; const accountHolderName = document.getElementById('accountHolderName').value;
            if (!aadhaar || !pan || !bankAccount || !ifscCode || !bankName || !accountHolderName) { showNotification('Please fill in all required fields.', 'warning'); return; }
            const aadhaarDoc = currentUser ? localStorage.getItem(`verificationDoc_${currentUser.uid}_aadhaar`) : null;
            const panDoc = currentUser ? localStorage.getItem(`verificationDoc_${currentUser.uid}_pan`) : null;
            if (!aadhaarDoc || !panDoc) { showNotification('Please upload both Aadhaar and PAN card documents. These are mandatory for verification.', 'error'); return; }

            userVerificationStatus = 'pending';
            localStorage.setItem('userVerificationStatus', 'pending');
            updateVerificationUI();
            showProfile();
            showNotification('Verification documents submitted successfully! We will review within 2-3 business days. Withdrawals will be enabled after approval.', 'success');
            document.getElementById('verificationForm').reset();
        }
        function updateVerificationUI() {
            const statusDiv = document.getElementById('verificationStatus');
            const withdrawalNotice = document.getElementById('withdrawalNotice');
            const withdrawalContent = document.getElementById('withdrawalContent');

            if (userVerificationStatus === 'verified') {
                statusDiv.className = 'verification-status verified'; statusDiv.innerHTML = `<h4><i class="fas fa-check-circle"></i> Account Verified</h4><p>Your account is fully verified. You can now create campaigns and withdraw funds.</p>`;
                if (withdrawalNotice) withdrawalNotice.style.display = 'none'; if (withdrawalContent) withdrawalContent.style.display = 'block';
            } else if (userVerificationStatus === 'pending') {
                statusDiv.className = 'verification-status pending'; statusDiv.innerHTML = `<h4><i class="fas fa-clock"></i> Verification Pending</h4><p>Your verification documents are under review. We will notify you once approved.</p>`;
                if (withdrawalNotice) { withdrawalNotice.className = 'verification-status pending'; withdrawalNotice.innerHTML = `<h4><i class="fas fa-clock"></i> Verification Pending</h4><p>Your verification is under review. Withdrawals will be enabled once approved.</p>`; }
            } else {
                statusDiv.className = 'verification-status unverified'; statusDiv.innerHTML = `<h4><i class="fas fa-exclamation-triangle"></i> Account Verification Required</h4><p>Please complete your profile verification to start fundraising and withdraw funds.</p><button class="btn btn-warning btn-small" onclick="showVerificationForm()"><i class="fas fa-shield-alt"></i> Complete Verification</button>`;
            }
        }
        function handleDocumentUpload(input, docType) {
            const file = input.files[0];
            if (!file) return;
            const maxSize = 5 * 1024 * 1024; // 5MB
            if (file.size > maxSize) { showNotification('File size exceeds 5MB limit. Please upload a smaller file.', 'error'); input.value = ''; return; }
            const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'application/pdf'];
            if (!allowedTypes.includes(file.type)) { showNotification('Only JPG, PNG, and PDF files are allowed.', 'error'); input.value = ''; return; }
            const reader = new FileReader();
            reader.onload = function(e) {
                if (currentUser) {
                    const docKey = `verificationDoc_${currentUser.uid}_${docType}`;
                    localStorage.setItem(docKey, e.target.result);
                    localStorage.setItem(`${docKey}_filename`, file.name);
                }
            };
            reader.readAsDataURL(file);
            const uploadDiv = document.getElementById(`${docType}UploadDiv`);
            if (uploadDiv) {
                uploadDiv.classList.add('has-file');
                uploadDiv.innerHTML = `<i class="fas fa-check-circle" style="font-size: 2rem; color: var(--success); margin-bottom: 1rem;"></i><p>${docType.toUpperCase()} uploaded successfully</p><small>${file.name} (${(file.size / 1024).toFixed(2)} KB)</small>`;
            }
        }

        // --- Withdrawals ---
        function showWithdrawals() {
            if (!currentUser) { showNotification('Please login to view withdrawals.', 'warning'); openModal('loginModal'); return; }
            document.getElementById('homePage').style.display = 'none'; document.getElementById('profileSection').classList.remove('active'); document.getElementById('verificationSection').classList.remove('active'); document.getElementById('campaignDetail').classList.remove('active'); document.getElementById('adminPanel').classList.remove('active'); document.getElementById('myDonationsSection').classList.remove('active'); document.getElementById('settingsSection').classList.remove('active'); document.getElementById('withdrawalsSection').classList.add('active');
            updateVerificationUI();
            loadUserCampaignsForWithdrawal();
            document.getElementById('dropdownMenu').style.display = 'none';
        }
        function loadUserCampaignsForWithdrawal() {
            const select = document.getElementById('withdrawalCampaign');
            if (!select) return;
            const userCampaigns = allCampaigns.filter(c => c.organizer && c.organizer.uid === currentUser.uid && c.status === 'active' && (c.raised || c.raisedAmount || 0) > 0);
            select.innerHTML = '<option value="">Select campaign to withdraw from</option>';
            userCampaigns.forEach(campaign => {
                const raised = campaign.raised || campaign.raisedAmount || 0;
                select.innerHTML += `<option value="${campaign.id}">${campaign.title} (₹${raised.toLocaleString()} raised)</option>`;
            });
        }
        async function submitWithdrawalRequest() {
            const campaignId = document.getElementById('withdrawalCampaign').value; const amount = document.getElementById('withdrawalAmount').value; const purpose = document.getElementById('withdrawalPurpose').value;
            if (!campaignId || !amount || !purpose) { showNotification('Please fill in all required fields.', 'warning'); return; }
            if (parseInt(amount) < 1000) { showNotification('Minimum withdrawal amount is ₹1,000.', 'warning'); return; }
            try { showNotification('Withdrawal request submitted successfully! You will be notified once processed.', 'success'); closeModal('withdrawalModal'); document.getElementById('withdrawalForm').reset(); }
            catch (error) { showNotification('Failed to submit withdrawal request: ' + error.message, 'error'); }
        }

        // --- Profile & User Data Management ---
        function loadUserCampaigns() {
            const campaignsContainer = document.getElementById('userCampaignsList');
            if (!currentUser) return;
            const userCampaigns = allCampaigns.filter(c => c.organizer && c.organizer.uid === currentUser.uid);
            if (userCampaigns.length === 0) {
                campaignsContainer.innerHTML = `<div class="empty-state"><i class="fas fa-heart-broken"></i><h3>No Campaigns Yet</h3><p>You haven't created any campaigns yet. Start your first fundraiser to make a difference!</p><button class="btn btn-primary" onclick="checkAuthAndStartCampaign()"><i class="fas fa-plus"></i> Create Your First Campaign</button></div>`;
            } else {
                campaignsContainer.innerHTML = userCampaigns.map(campaign => {
                    const raised = campaign.raised || campaign.raisedAmount || 0; const goal = campaign.goal || campaign.goalAmount;
                    const progressPercentage = Math.min((raised / goal) * 100, 100);
                    let statusBadge = ''; let statusColor = '';
                    if (campaign.status === 'pending') { statusBadge = 'Under Review'; statusColor = '#f57c00'; }
                    else if (campaign.status === 'active') { statusBadge = 'Active'; statusColor = '#28a745'; }
                    else if (campaign.status === 'completed') { statusBadge = 'Completed'; statusColor = '#6c757d'; }
                    return `
                        <div class="campaign-card" style="margin-bottom: 1rem;">
                            <div class="campaign-image-container">
                                <img src="${campaign.image || getDefaultCategoryImage(campaign.category)}" alt="${campaign.title}" class="campaign-image">
                                <div class="campaign-badge" style="background: ${statusColor}">${statusBadge}</div>
                            </div>
                            <div class="campaign-content">
                                <h3 class="campaign-title">${campaign.title}</h3>
                                <p class="campaign-organizer">${campaign.location}</p>
                                <div class="campaign-progress">
                                    <div class="progress-bar"><div class="progress-fill" style="width: ${progressPercentage}%"></div></div>
                                    <div class="progress-info"><span>₹${raised.toLocaleString()}</span><span>₹${goal.toLocaleString()}</span></div>
                                    <div class="progress-info"><span>${campaign.donors || 0} donors</span><span>${campaign.daysLeft === 999 ? 'Ongoing' : campaign.daysLeft + ' days left'}</span></div>
                                </div>
                                <div class="campaign-footer">
                                    <div class="campaign-actions">
                                        <button class="btn btn-outline btn-small" onclick="viewCampaign('${campaign.id}')"><i class="fas fa-eye"></i> View</button>
                                        ${campaign.status === 'active' ? `<button class="btn btn-primary btn-small" onclick="showDonationModal('${campaign.id}')"><i class="fas fa-heart"></i> Share</button>` : ''}
                                    </div>
                                    <div class="admin-actions">
                                        <button class="delete-btn" onclick="deleteCampaign('${campaign.id}')" title="Delete Campaign"><i class="fas fa-trash"></i></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }
        }
        function showMyDonations() {
            if (!currentUser) { showNotification('Please login to view your donations.', 'warning'); openModal('loginModal'); return; }
            document.getElementById('homePage').style.display = 'none'; document.getElementById('profileSection').classList.remove('active'); document.getElementById('verificationSection').classList.remove('active'); document.getElementById('campaignDetail').classList.remove('active'); document.getElementById('adminPanel').classList.remove('active'); document.getElementById('withdrawalsSection').classList.remove('active'); document.getElementById('settingsSection').classList.remove('active'); document.getElementById('myDonationsSection').classList.add('active');
            loadMyDonations(); document.getElementById('dropdownMenu').style.display = 'none';
        }
        function loadMyDonations() {
            const donationsContainer = document.getElementById('userDonationsList');
            const sampleDonations = [
                { id: 'don_001', campaignTitle: 'Help 4-Year-Old Aarav Fight Leukemia', amount: 5000, date: new Date('2025-02-15'), message: 'Praying for quick recovery!' },
                { id: 'don_002', campaignTitle: 'Education for Meera', amount: 2500, date: new Date('2025-02-10'), message: 'Education is the key to success!' }
            ];
            const hasDonations = Math.random() > 0.7;
            if (!hasDonations || sampleDonations.length === 0) {
                donationsContainer.innerHTML = `<div class="empty-state"><i class="fas fa-hand-holding-heart"></i><h3>No Donations Yet</h3><p>You haven't made any donations yet. Your generosity can change lives and make a real difference in someone's journey.</p><div style="margin: 2rem 0;"><h4 style="color: var(--primary); margin-bottom: 1rem;">Ready to Make a Greater Good?</h4><p style="color: var(--gray); margin-bottom: 2rem;">Every donation, no matter how small, creates ripples of hope. Join thousands of compassionate Indians in supporting causes that matter.</p></div><button class="btn btn-primary btn-large" onclick="showHomePage(); setTimeout(scrollToCampaigns, 100);"><i class="fas fa-heart"></i> Donate Now to Make a Greater Good</button><button class="btn btn-outline" onclick="showHomePage(); setTimeout(scrollToCampaigns, 100);" style="margin-left: 1rem;"><i class="fas fa-search"></i> Browse All Campaigns</button></div>`;
            } else {
                donationsContainer.innerHTML = `
                    <div style="margin-bottom: 2rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: var(--light); border-radius: 8px;">
                            <div><h4 style="margin: 0; color: var(--primary);">Total Donated: ₹${sampleDonations.reduce((sum, d) => sum + d.amount, 0).toLocaleString()}</h4><p style="margin: 0; color: var(--gray);">Thank you for making a difference!</p></div>
                            <button class="btn btn-primary" onclick="showHomePage(); setTimeout(scrollToCampaigns, 100);"><i class="fas fa-plus"></i> Donate More</button>
                        </div>
                    </div>
                    ${sampleDonations.map(donation => `
                        <div class="campaign-card" style="margin-bottom: 1rem;">
                            <div class="campaign-content">
                                <h3 class="campaign-title">${donation.campaignTitle}</h3>
                                <div style="display: flex; justify-content: space-between; align-items: center; margin: 1rem 0;">
                                    <span style="font-size: 1.2rem; font-weight: 600; color: var(--primary);">₹${donation.amount.toLocaleString()}</span>
                                    <span style="color: var(--gray);">${formatDate(donation.date)}</span>
                                </div>
                                <p style="color: var(--gray); font-style: italic;">"${donation.message}"</p>
                                <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border);">
                                    <button class="btn btn-outline btn-small" onclick="downloadTaxReceipt('${donation.id}')"><i class="fas fa-download"></i> Download Tax Receipt</button>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                `;
            }
        }
        function downloadTaxReceipt(donationId) { showNotification('Tax receipt downloaded successfully!', 'success'); }
        function showSettings() {
            if (!currentUser) { showNotification('Please login to access settings.', 'warning'); openModal('loginModal'); return; }
            document.getElementById('homePage').style.display = 'none'; document.getElementById('profileSection').classList.remove('active'); document.getElementById('verificationSection').classList.remove('active'); document.getElementById('campaignDetail').classList.remove('active'); document.getElementById('adminPanel').classList.remove('active'); document.getElementById('withdrawalsSection').classList.remove('active'); document.getElementById('myDonationsSection').classList.remove('active'); document.getElementById('settingsSection').classList.add('active');
            loadSettings(); document.getElementById('dropdownMenu').style.display = 'none';
        }
        function loadSettings() {
            const settingsContainer = document.getElementById('settingsContent');
            settingsContainer.innerHTML = `
                <div class="profile-card">
                    <h3><i class="fas fa-user-cog"></i> Account Preferences</h3>
                    <div class="form-group">
                        <label class="form-label">Email Notifications</label>
                        <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                            <label style="display: flex; align-items: center; gap: 0.5rem;"><input type="checkbox" checked> Campaign updates and milestones</label>
                            <label style="display: flex; align-items: center; gap: 0.5rem;"><input type="checkbox" checked> New campaigns in your interest areas</label>
                            <label style="display: flex; align-items: center; gap: 0.5rem;"><input type="checkbox"> Weekly digest of trending campaigns</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Privacy Settings</label>
                        <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                            <label style="display: flex; align-items: center; gap: 0.5rem;"><input type="checkbox" checked> Show my name in donation lists</label>
                            <label style="display: flex; align-items: center; gap: 0.5rem;"><input type="checkbox"> Allow others to contact me about campaigns</label>
                        </div>
                    </div>
                    <button class="btn btn-primary">Save Preferences</button>
                </div>
                <div class="profile-card" style="margin-top: 2rem;">
                    <h3><i class="fas fa-wallet"></i> Payment & Withdrawal Settings</h3>
                    <div style="background: #fff3e0; padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem; border-left: 4px solid #f57c00;"><h4 style="margin: 0 0 1rem 0; color: #f57c00;">Withdrawal Management</h4><p style="margin: 0; color: #f57c00;">All withdrawals are subject to verification and require proper documentation. Complete your account verification to enable withdrawals.</p></div>
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                        <button class="btn btn-outline" onclick="showVerificationForm()"><i class="fas fa-shield-alt"></i> Complete Verification</button>
                        <button class="btn btn-outline" onclick="showWithdrawals()"><i class="fas fa-money-bill"></i> Withdrawal History</button>
                    </div>
                </div>
                <div class="profile-card" style="margin-top: 2rem;">
                    <h3><i class="fas fa-chart-line"></i> Campaign Analytics</h3>
                    <p style="color: var(--gray); margin-bottom: 1.5rem;">Track the performance of your campaigns and understand your donor base.</p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
                        <div style="text-align: center; padding: 1rem; background: var(--light); border-radius: 8px;"><div style="font-size: 1.5rem; font-weight: 600; color: var(--primary);">0</div><div style="color: var(--gray);">Active Campaigns</div></div>
                        <div style="text-align: center; padding: 1rem; background: var(--light); border-radius: 8px;"><div style="font-size: 1.5rem; font-weight: 600; color: var(--success);">₹0</div><div style="color: var(--gray);">Total Raised</div></div>
                        <div style="text-align: center; padding: 1rem; background: var(--light); border-radius: 8px;"><div style="font-size: 1.5rem; font-weight: 600; color: var(--accent);">0</div><div style="color: var(--gray);">Total Supporters</div></div>
                    </div>
                    <button class="btn btn-primary" onclick="showProfile()"><i class="fas fa-plus"></i> Create New Campaign</button>
                </div>
                <div class="profile-card" style="margin-top: 2rem;">
                    <h3><i class="fas fa-graduation-cap"></i> Student Fundraising</h3>
                    <div style="background: #e3f2fd; padding: 1.5rem; border-radius: 8px; border-left: 4px solid #2196f3;"><h4 style="margin: 0 0 1rem 0; color: #1976d2;">Special Support for Students</h4><p style="margin: 0 0 1rem 0; color: #1565c0;">Students can raise donations for:</p><ul style="margin: 0; padding-left: 1.5rem; color: #1565c0;"><li><strong>Purchasing Books:</strong> Textbooks, reference materials, and study guides</li><li><strong>Tuition Fees:</strong> College fees, course fees, and examination fees</li><li><strong>Educational Equipment:</strong> Laptops, tablets, and software for studies</li><li><strong>Research Projects:</strong> Funding for thesis, research, and project work</li><li><strong>Educational Travel:</strong> Conference attendance, internships, and study abroad</li></ul></div>
                    <div style="margin-top: 1rem;"><button class="btn btn-primary" onclick="checkAuthAndStartCampaign()"><i class="fas fa-graduation-cap"></i> Start Student Campaign</button></div>
                </div>
                <div class="profile-card" style="margin-top: 2rem;">
                    <h3><i class="fas fa-trash-alt"></i> Account Actions</h3>
                    <p style="color: var(--gray); margin-bottom: 1.5rem;">Manage your account data and preferences.</p>
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                        <button class="btn btn-outline" onclick="exportAccountData()"><i class="fas fa-download"></i> Export Account Data</button>
                        <button class="btn btn-danger" onclick="deleteAccount()"><i class="fas fa-exclamation-triangle"></i> Delete Account</button>
                    </div>
                </div>
            `;
        }
        function exportAccountData() { showNotification('Account data export initiated. You will receive an email shortly.', 'success'); }
        function deleteAccount() { if (confirm('Are you sure you want to delete your account? This action cannot be undone.')) { showNotification('Account deletion requested. Please check your email for confirmation.', 'warning'); } }
        function scrollToCampaigns() { document.getElementById('campaigns').scrollIntoView({ behavior: 'smooth' }); }

        // Info modal functionality for footer sections
        function openInfoModal(type) {
            const modal = document.getElementById('infoModal'); const title = document.getElementById('infoModalTitle'); const icon = document.getElementById('infoModalIcon'); const body = document.getElementById('infoModalBody');
            const infoContent = {
                howItWorks: { icon: 'fas fa-info-circle', title: 'How It Works', body: `<div style="line-height: 1.6;"><h3>1. Create Your Campaign</h3><p>Tell your story, add photos, and set your fundraising goal. Our team reviews each campaign to ensure authenticity.</p><h3>2. Share Your Campaign</h3><p>Share your campaign link with friends, family, and social media. The more people who see it, the more support you'll receive.</p><h3>3. Receive Donations</h3><p>Donors can contribute directly through our secure platform. All donations are processed safely and securely.</p><h3>4. Withdraw Funds</h3><p>Request withdrawals anytime with proper documentation. Funds are transferred to your verified bank account within 3-5 business days.</p><h3>5. Update Your Supporters</h3><p>Keep donors informed about your progress and how their contributions are making a difference.</p></div>` },
                safety: { icon: 'fas fa-shield-alt', title: 'Safety & Security', body: `<div style="line-height: 1.6;"><h3>Campaign Verification</h3><p>Every campaign is manually reviewed by our team. We verify organizer identity and campaign authenticity before approval.</p><h3>Secure Payments</h3><p>All payments are processed through PCI DSS compliant gateways. We use industry-standard encryption to protect your data.</p><h3>Fund Protection</h3><p>Funds are held in secure escrow accounts. Withdrawals require proper documentation and verification.</p><h3>Fraud Prevention</h3><p>We use advanced fraud detection systems and manual reviews to prevent misuse of our platform.</p><h3>24/7 Monitoring</h3><p>Our security team monitors the platform round-the-clock for suspicious activities and ensures user safety.</p></div>` },
                pricing: { icon: 'fas fa-rupee-sign', title: 'Pricing & Fees', body: `<div style="line-height: 1.6;"><h3>Platform Fee: 5%</h3><p>We charge a 5% platform fee on successfully raised funds to maintain our platform and provide support services.</p><h3>Payment Gateway Charges</h3><p>Standard payment gateway charges apply (2-3%) for processing donations through credit/debit cards and digital wallets.</p><h3>No Hidden Costs</h3><p>Creating campaigns is completely free. You only pay when you successfully raise funds.</p><h3>Withdrawal Fees</h3><p>Bank transfer charges may apply based on your bank's policy. We don't charge extra for fund withdrawals.</p><h3>Tax Benefits</h3><p>Donations made through our platform are eligible for tax benefits under Section 80G of the Income Tax Act.</p></div>` },
                help: { icon: 'fas fa-question-circle', title: 'Help Center & FAQs', body: `<div style="line-height: 1.6;"><h3>Frequently Asked Questions</h3><h4>How do I create a campaign?</h4><p>Click "Start Fundraiser", fill in your campaign details, upload supporting documents, and submit for review.</p><h4>How long does verification take?</h4><p>Campaign verification typically takes 24-48 hours. Account verification may take 2-3 business days.</p><h4>When can I withdraw funds?</h4><p>You can request withdrawals anytime after receiving donations. Provide proper documentation for faster processing.</p><h4>What documents do I need?</h4><p>For verification: Aadhaar, PAN, and bank details. For withdrawals: Bills, receipts, or medical reports related to your cause.</p><h4>Is there a minimum withdrawal amount?</h4><p>Yes, the minimum withdrawal amount is ₹1,000 to cover processing costs.</p><h4>How do I share my campaign?</h4><p>Use the share button on your campaign page to share via social media, WhatsApp, email, or copy the link.</p><h4>Can I edit my campaign after submission?</h4><p>Minor edits are allowed. Contact support for major changes after campaign approval.</p><h4>What if my campaign doesn't reach its goal?</h4><p>You can still withdraw the funds raised. Most campaigns receive ongoing support even after their target date.</p></div>` },
                contact: { icon: 'fas fa-headset', title: 'Contact Support', body: `<div style="line-height: 1.6;"><h3>24/7 Support Available</h3><p>Our dedicated support team is here to help you with any questions or concerns.</p><h3>Contact Methods</h3><div style="background: var(--light); padding: 1.5rem; border-radius: 8px; margin: 1rem 0;"><p><strong>\uD83D\uDCDE Phone:</strong> +91-124-4567890 (24/7)</p><p><strong>\uD83D\uDCE7 Email:</strong> support@flappingbird.in</p><p><strong>\uD83D\uDCAC Live Chat:</strong> Available on our website</p><p><strong>\uD83D\uDCF1 WhatsApp:</strong> +91-9876543210</p></div><h3>Support Hours</h3><p>Our team is available 24/7 for urgent issues. General queries are responded to within 2-4 hours.</p><h3>Common Issues We Help With</h3><ul><li>Campaign creation and verification</li><li>Payment and withdrawal issues</li><li>Account verification problems</li><li>Technical difficulties</li><li>Donor refund requests</li></ul></div>` },
                terms: { icon: 'fas fa-file-contract', title: 'Terms of Service', body: `<div style="line-height: 1.6;"><h3>Platform Usage</h3><p>By using Flapping Bird, you agree to use the platform responsibly and for legitimate fundraising purposes only.</p><h3>Campaign Guidelines</h3><p>All campaigns must be truthful, legal, and for genuine causes. Misrepresentation may result in account suspension.</p><h3>Payment Terms</h3><p>Platform fees and payment gateway charges apply as mentioned in our pricing policy.</p><h3>Withdrawal Policy</h3><p>Funds can be withdrawn after proper verification. We reserve the right to hold funds for suspicious activities.</p><h3>Account Termination</h3><p>We may terminate accounts that violate our terms or engage in fraudulent activities.</p><h3>Limitation of Liability</h3><p>Flapping Bird acts as a platform facilitator. Campaign success depends on organizer efforts and donor response.</p></div>` },
                privacy: { icon: 'fas fa-user-shield', title: 'Privacy Policy', body: `<div style="line-height: 1.6;"><h3>Data Collection</h3><p>We collect only necessary information to provide our services - personal details, payment information, and campaign data.</p><h3>Data Usage</h3><p>Your data is used for account management, payment processing, and improving our services. We don't sell personal information.</p><h3>Data Security</h3><p>We use industry-standard encryption and security measures to protect your personal and financial information.</p><h3>Third-Party Sharing</h3><p>We share data only with trusted payment processors and service providers under strict confidentiality agreements.</p><h3>Cookie Policy</h3><p>We use cookies to improve user experience and analyze platform usage. You can control cookie settings in your browser.</p><h3>Data Rights</h3><p>You have the right to access, modify, or delete your personal data. Contact support for data-related requests.</p></div>` },
                refund: { icon: 'fas fa-undo', title: 'Refund Policy', body: `<div style="line-height: 1.6;"><h3>Donor Refunds</h3><p>Donors can request refunds within 7 days of donation if the campaign is found to be fraudulent or misrepresented.</p><h3>Campaign Cancellation</h3><p>If a campaign is cancelled or found invalid, all donations are automatically refunded to donors within 5-7 business days.</p><h3>Platform Fee Refunds</h3><p>Platform fees are non-refundable once a campaign is successfully completed and funds are withdrawn.</p><h3>Payment Gateway Charges</h3><p>Payment gateway charges are non-refundable as they are processed by third-party providers.</p><h3>Refund Process</h3><p>Refunds are processed to the original payment method within 5-10 business days after approval.</p><h3>Dispute Resolution</h3><p>For refund disputes, contact our support team with transaction details and reason for refund request.</p></div>` },
                guidelines: { icon: 'fas fa-clipboard-list', title: 'Campaign Guidelines', body: `<div style="line-height: 1.6;"><h3>Allowed Campaigns</h3><ul><li>Medical treatments and emergency healthcare</li><li>Education fees, books, and learning materials</li><li>Disaster relief and emergency assistance</li><li>Animal welfare and rescue operations</li><li>Community development projects</li><li>Debt relief for genuine financial hardships</li></ul><h3>Prohibited Content</h3><ul><li>False or misleading information</li><li>Illegal activities or purposes</li><li>Hate speech or discrimination</li><li>Personal profit or business ventures</li><li>Political campaigns or religious conversion</li></ul><h3>Documentation Required</h3><p>Medical campaigns: Hospital bills, doctor's reports, treatment estimates</p><p>Education campaigns: Admission letters, fee receipts, student ID</p><p>Emergency campaigns: Official reports, damage certificates</p></div>` },
                tax: { icon: 'fas fa-receipt', title: 'Tax Benefits', body: `<div style="line-height: 1.6;"><h3>Tax Deduction for Donors</h3><p>Donations made through registered charitable campaigns are eligible for tax deduction under Section 80G of the Income Tax Act.</p><h3>Tax Receipts</h3><p>Eligible donors receive official tax receipts via email within 48 hours of donation.</p><h3>TDS on Withdrawals</h3><p>TDS may be applicable on large withdrawals as per current tax regulations. Consult your tax advisor for details.</p><h3>GST on Platform Fees</h3><p>Platform fees include applicable GST as per current tax rates.</p><h3>Income Tax Liability</h3><p>Campaign organizers are responsible for declaring received funds as per income tax regulations.</p></div>` }
            };
            const content = infoContent[type];
            if (content) {
                icon.className = content.icon;
                title.innerHTML = `<i class="${content.icon}"></i> ${content.title}`;
                body.innerHTML = content.body;
                modal.style.display = 'block';
            }
        }

        // Handle payment success redirection
        function handlePaymentSuccess() {
            const pendingDonation = sessionStorage.getItem('pendingDonation');
            if (pendingDonation) {
                const donation = JSON.parse(pendingDonation);
                completeDonation(donation.campaignId, donation.amount, donation.name, donation.email, donation.message);
                sessionStorage.removeItem('pendingDonation');
            }
        }
        window.addEventListener('focus', function() {
            const pendingDonation = sessionStorage.getItem('pendingDonation');
            if (pendingDonation) {
                if (confirm('Did you complete your payment successfully?')) {
                    handlePaymentSuccess();
                } else {
                    sessionStorage.removeItem('pendingDonation');
                }
            }
        });

        // FAQ toggle
        function toggleFAQ(element) {
            const faqItem = element.parentElement;
            document.querySelectorAll('.faq-item').forEach(item => item.classList.remove('active'));
            if (!faqItem.classList.contains('active')) {
                faqItem.classList.add('active');
            }
        }

        // --- Login & Signup Functions ---
        async function handleLogin() {
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                showNotification('Please enter email and password.', 'warning');
                return;
            }

            try {
                showNotification('Logging in...', 'info');
                const { signInWithEmailAndPassword } = window.firebaseServices;
                const userCredential = await signInWithEmailAndPassword(window.firebaseServices.auth, email, password);

                const isAdmin = email === 'vishuu7306@gmail.com';
                currentUser = {
                    uid: userCredential.user.uid,
                    name: userCredential.user.displayName || email.split('@')[0],
                    email: email,
                    phone: '',
                    isAdmin: isAdmin
                };

                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                updateAuthUI();
                closeModal('loginModal');
                document.getElementById('loginForm').reset();
                showNotification('Login successful! Welcome back.', 'success');

                if (isAdmin) {
                    showNotification('Admin access granted.', 'success');
                }
            } catch (error) {
                console.error('Login error:', error);
                if (error.code === 'auth/user-not-found') {
                    showNotification('No account found with this email. Please sign up.', 'error');
                } else if (error.code === 'auth/wrong-password') {
                    showNotification('Incorrect password. Please try again.', 'error');
                } else if (error.code === 'auth/invalid-email') {
                    showNotification('Invalid email format.', 'error');
                } else {
                    showNotification('Login failed: ' + error.message, 'error');
                }
            }
        }

        async function handleSignup() {
            const name = document.getElementById('signupName').value.trim();
            const email = document.getElementById('signupEmail').value.trim();
            const phone = document.getElementById('signupPhone').value.trim();
            const password = document.getElementById('signupPassword').value;

            if (!name || !email || !phone || !password) {
                showNotification('Please fill in all fields.', 'warning');
                return;
            }

            if (password.length < 6) {
                showNotification('Password must be at least 6 characters.', 'warning');
                return;
            }

            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                showNotification('Please enter a valid email address.', 'error');
                return;
            }

            const phoneRegex = /^[0-9]{10}$/;
            if (!phoneRegex.test(phone)) {
                showNotification('Please enter a valid 10-digit phone number.', 'warning');
                return;
            }

            pendingSignupData = { name, email, phone, password };
            await sendSignupOTP(name, email);
        }

        // --- Add Payout Function ---
        async function addPayout() {
            const campaign = allCampaigns.find(c => c.id === currentCampaignId);
            if (!campaign) {
                showNotification('Campaign not found!', 'error');
                return;
            }

            const canManage = currentUser && (
                currentUser.isAdmin || 
                (campaign.organizer && campaign.organizer.uid === currentUser.uid)
            );

            if (!canManage) {
                showNotification('You do not have permission to add payouts.', 'error');
                return;
            }

            const amount = parseInt(document.getElementById('payoutAmount').value);
            const purpose = document.getElementById('payoutPurpose').value;
            const date = new Date(document.getElementById('payoutDate').value);

            if (!amount || !purpose || !date || isNaN(date.getTime())) {
                showNotification('Please fill in all fields correctly.', 'warning');
                return;
            }

            try {
                showNotification('Adding payout...', 'info');

                const newPayout = {
                    id: `${campaign.id}-payout-${Date.now()}`,
                    amount: amount,
                    purpose: purpose,
                    date: date,
                    campaignId: campaign.id
                };

                if (!campaign.payouts) campaign.payouts = [];
                campaign.payouts.unshift(newPayout);
                campaign.updatedAt = new Date();

                // Save to Firestore
                const { setDoc, doc } = window.firebaseServices;
                const db = window.firebaseServices.db;
                await setDoc(doc(db, 'campaigns', campaign.id), campaign);

                // Update local array
                const campaignIndex = allCampaigns.findIndex(c => c.id === campaign.id);
                if (campaignIndex !== -1) {
                    allCampaigns[campaignIndex] = campaign;
                }
                
                showNotification('Payout added successfully!', 'success');
                document.getElementById('addPayoutForm').reset();
                viewCampaign(currentCampaignId); // Reload campaign view
            } catch (error) {
                console.error('Error adding payout:', error);
                showNotification('Failed to add payout: ' + error.message, 'error');
            }
        }

        // --- Add Update Function ---
        async function addUpdate() {
            const campaign = allCampaigns.find(c => c.id === currentCampaignId);
            if (!campaign) {
                showNotification('Campaign not found!', 'error');
                return;
            }

            const canManage = currentUser && (
                currentUser.isAdmin || 
                (campaign.organizer && campaign.organizer.uid === currentUser.uid)
            );

            if (!canManage) {
                showNotification('You do not have permission to add updates.', 'error');
                return;
            }

            const title = document.getElementById('updateTitle').value;
            const text = document.getElementById('updateText').value;
            const date = new Date(document.getElementById('updateDate').value);

            if (!title || !text || !date || isNaN(date.getTime())) {
                showNotification('Please fill in all fields correctly.', 'warning');
                return;
            }

            try {
                showNotification('Adding update...', 'info');

                const newUpdate = {
                    id: `${campaign.id}-update-${Date.now()}`,
                    title: title,
                    text: text,
                    date: date,
                    campaignId: campaign.id
                };

                if (!campaign.updates) campaign.updates = [];
                campaign.updates.unshift(newUpdate);
                campaign.updatedAt = new Date();

                // Save to Firestore
                const { setDoc, doc } = window.firebaseServices;
                const db = window.firebaseServices.db;
                await setDoc(doc(db, 'campaigns', campaign.id), campaign);

                // Update local array
                const campaignIndex = allCampaigns.findIndex(c => c.id === campaign.id);
                if (campaignIndex !== -1) {
                    allCampaigns[campaignIndex] = campaign;
                }
                
                showNotification('Update added successfully!', 'success');
                document.getElementById('addUpdateForm').reset();
                viewCampaign(currentCampaignId); // Reload campaign view
            } catch (error) {
                console.error('Error adding update:', error);
                showNotification('Failed to add update: ' + error.message, 'error');
            }
        }

        // --- Event Listeners & Initialization ---
        document.addEventListener('DOMContentLoaded', function() {
            initializeSampleCampaigns(); // Load initial data (Firebase or fallback)

            // Check for campaign parameter in URL
            const urlParams = new URLSearchParams(window.location.search);
            const campaignId = urlParams.get('campaign');
            if (campaignId) {
                // Wait for campaigns to load, then open the specific campaign
                setTimeout(() => {
                    const campaign = allCampaigns.find(c => c.id === campaignId);
                    if (campaign) {
                        viewCampaign(campaignId);
                    } else {
                        showNotification('Campaign not found', 'error');
                        showHomePage();
                    }
                }, 1000);
            }

            // Initialize success stories carousel
            const successCarousel = document.getElementById('successStoriesCarousel');
            if (successCarousel) {
                addCarouselNavigation(successCarousel);
            }

            // Form event listeners
            document.getElementById('loginForm').addEventListener('submit', e => { e.preventDefault(); handleLogin(); });
            document.getElementById('signupForm').addEventListener('submit', e => { e.preventDefault(); handleSignup(); });
            document.getElementById('otpForm').addEventListener('submit', e => { e.preventDefault(); verifyOTP(); });
            document.getElementById('campaignForm').addEventListener('submit', e => { e.preventDefault(); createCampaign(); });
            document.getElementById('verificationForm').addEventListener('submit', e => { e.preventDefault(); submitVerification(); });
            document.getElementById('withdrawalForm').addEventListener('submit', e => { e.preventDefault(); submitWithdrawalRequest(); });
            document.getElementById('donationForm').addEventListener('submit', e => {
                e.preventDefault();
                const amount = document.getElementById('donationAmount').value;
                const name = document.getElementById('donorName').value;
                const email = document.getElementById('donorEmail').value;
                const message = document.getElementById('donorMessage').value;
                processDonation(amount, name, email, message);
            });
            document.getElementById('addPayoutForm').addEventListener('submit', e => { e.preventDefault(); addPayout(); });
            document.getElementById('addUpdateForm').addEventListener('submit', e => { e.preventDefault(); addUpdate(); });

            // Filter button listeners
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    filterCampaigns(this.dataset.filter);
                });
            });

            // Close modals by clicking outside
            window.addEventListener('click', e => { if (e.target.classList.contains('modal')) { e.target.style.display = 'none'; } });
            // Close dropdown by clicking outside
            document.addEventListener('click', e => { if (!e.target.closest('.user-menu')) { document.getElementById('dropdownMenu').style.display = 'none'; } });

            // Firebase auth state listener
            if (window.firebaseServices) {
                window.firebaseServices.onAuthStateChanged(window.firebaseServices.auth, (user) => {
                    if (user && !currentUser) {
                        const isAdmin = user.email === 'vishuu7306@gmail.com';
                        currentUser = { uid: user.uid, name: user.displayName || user.email.split('@')[0], email: user.email, phone: '', isAdmin: isAdmin };
                        updateAuthUI();
                    } else if (!user && currentUser) {
                        currentUser = null;
                        updateAuthUI();
                    }
                });
            }
        });
    </script>
</body>
</html>